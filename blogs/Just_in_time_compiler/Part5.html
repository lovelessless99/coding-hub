<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Just In Time Compiler - Part 5. Cross Comparison - 效能大亂鬥 | Coding Hub</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/coding-hub/code.ico">
    <link rel="manifest" href="/coding-hub/manifest.json">
    <link rel="apple-touch-icon" href="/coding-hub/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/coding-hub/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="比較 JIT compiler, sed, interpreter, 及優化實作的效率">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/app_icons/192.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    
    <link rel="preload" href="/coding-hub/assets/css/0.styles.2277b98e.css" as="style"><link rel="preload" href="/coding-hub/assets/js/app.df64d80b.js" as="script"><link rel="preload" href="/coding-hub/assets/js/6.5a677154.js" as="script"><link rel="preload" href="/coding-hub/assets/js/1.0bfbaed9.js" as="script"><link rel="preload" href="/coding-hub/assets/js/27.fa8870a1.js" as="script"><link rel="preload" href="/coding-hub/assets/js/11.c55c4bcd.js" as="script"><link rel="prefetch" href="/coding-hub/assets/js/10.153f0244.js"><link rel="prefetch" href="/coding-hub/assets/js/12.5069d591.js"><link rel="prefetch" href="/coding-hub/assets/js/13.288e3bf1.js"><link rel="prefetch" href="/coding-hub/assets/js/14.98923b0d.js"><link rel="prefetch" href="/coding-hub/assets/js/15.12c58ad1.js"><link rel="prefetch" href="/coding-hub/assets/js/16.0b588d4f.js"><link rel="prefetch" href="/coding-hub/assets/js/17.f13925a9.js"><link rel="prefetch" href="/coding-hub/assets/js/18.47e56f78.js"><link rel="prefetch" href="/coding-hub/assets/js/19.bf916fa9.js"><link rel="prefetch" href="/coding-hub/assets/js/20.a4e1868f.js"><link rel="prefetch" href="/coding-hub/assets/js/21.0e84c3fb.js"><link rel="prefetch" href="/coding-hub/assets/js/22.c39fdcb6.js"><link rel="prefetch" href="/coding-hub/assets/js/23.0e9db64a.js"><link rel="prefetch" href="/coding-hub/assets/js/24.1b64b869.js"><link rel="prefetch" href="/coding-hub/assets/js/25.bee36556.js"><link rel="prefetch" href="/coding-hub/assets/js/26.5f1157e4.js"><link rel="prefetch" href="/coding-hub/assets/js/28.80c49a2c.js"><link rel="prefetch" href="/coding-hub/assets/js/29.b0305a5d.js"><link rel="prefetch" href="/coding-hub/assets/js/30.ee376dfa.js"><link rel="prefetch" href="/coding-hub/assets/js/31.2d302251.js"><link rel="prefetch" href="/coding-hub/assets/js/32.1e1bc032.js"><link rel="prefetch" href="/coding-hub/assets/js/33.72890909.js"><link rel="prefetch" href="/coding-hub/assets/js/34.fa67bc52.js"><link rel="prefetch" href="/coding-hub/assets/js/35.f74092dd.js"><link rel="prefetch" href="/coding-hub/assets/js/36.a847b223.js"><link rel="prefetch" href="/coding-hub/assets/js/37.1b012f6e.js"><link rel="prefetch" href="/coding-hub/assets/js/38.7628525e.js"><link rel="prefetch" href="/coding-hub/assets/js/39.f8aff88f.js"><link rel="prefetch" href="/coding-hub/assets/js/40.91e31a7c.js"><link rel="prefetch" href="/coding-hub/assets/js/41.d151ce20.js"><link rel="prefetch" href="/coding-hub/assets/js/42.824efee6.js"><link rel="prefetch" href="/coding-hub/assets/js/43.103899ed.js"><link rel="prefetch" href="/coding-hub/assets/js/44.4998e954.js"><link rel="prefetch" href="/coding-hub/assets/js/7.ff64a05d.js"><link rel="prefetch" href="/coding-hub/assets/js/8.9c5e7b1f.js"><link rel="prefetch" href="/coding-hub/assets/js/9.df73a708.js"><link rel="prefetch" href="/coding-hub/assets/js/vendors~flowchart.15880f81.js"><link rel="prefetch" href="/coding-hub/assets/js/vendors~mermaid.db8915cf.js"><link rel="prefetch" href="/coding-hub/assets/js/vendors~reveal.2eb356a7.js">
    <link rel="stylesheet" href="/coding-hub/assets/css/0.styles.2277b98e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Coding Hub</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Less is more.</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Lawrence</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coding-hub/" class="home-link router-link-active"><img src="/coding-hub/coding.png" alt="Coding Hub" class="logo"> <span class="site-name">Coding Hub</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coding-hub/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding-hub/categories/ELF/" class="nav-link"><i class="undefined"></i>
  ELF
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/JIT compiler/" class="nav-link"><i class="undefined"></i>
  JIT compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/IEEE 754/" class="nav-link"><i class="undefined"></i>
  IEEE 754
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/AI Compiler/" class="nav-link"><i class="undefined"></i>
  AI Compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Pypy and Rpython/" class="nav-link"><i class="undefined"></i>
  Pypy and Rpython
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/LLVM/" class="nav-link"><i class="undefined"></i>
  LLVM
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Python Internal/" class="nav-link"><i class="undefined"></i>
  Python Internal
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Virtual Machine/" class="nav-link"><i class="undefined"></i>
  Virtual Machine
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/MLIR/" class="nav-link"><i class="undefined"></i>
  MLIR
</a></li></ul></div></div><div class="nav-item"><a href="/coding-hub/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/coding-hub/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/coding-hub/blogs/aboutme/aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  About me
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lovelessless99" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/chih-yu-hsu-06a0091b8/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-linkedin"></i>
  Linkedin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="mailto:lovelessless99@gmail.com" class="nav-link external"><i class="iconfont reco-mail"></i>
  Gmail
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/coding-hub/head.gif" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Lawrence
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>22</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>16</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/coding-hub/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding-hub/categories/ELF/" class="nav-link"><i class="undefined"></i>
  ELF
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/JIT compiler/" class="nav-link"><i class="undefined"></i>
  JIT compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/IEEE 754/" class="nav-link"><i class="undefined"></i>
  IEEE 754
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/AI Compiler/" class="nav-link"><i class="undefined"></i>
  AI Compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Pypy and Rpython/" class="nav-link"><i class="undefined"></i>
  Pypy and Rpython
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/LLVM/" class="nav-link"><i class="undefined"></i>
  LLVM
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Python Internal/" class="nav-link"><i class="undefined"></i>
  Python Internal
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Virtual Machine/" class="nav-link"><i class="undefined"></i>
  Virtual Machine
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/MLIR/" class="nav-link"><i class="undefined"></i>
  MLIR
</a></li></ul></div></div><div class="nav-item"><a href="/coding-hub/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/coding-hub/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/coding-hub/blogs/aboutme/aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  About me
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lovelessless99" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/chih-yu-hsu-06a0091b8/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-linkedin"></i>
  Linkedin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="mailto:lovelessless99@gmail.com" class="nav-link external"><i class="iconfont reco-mail"></i>
  Gmail
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Just In Time Compiler</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coding-hub/blogs/Just_in_time_compiler/JIT.html" class="sidebar-link">Just In Time Compiler - Part 0. 專案說明與綜觀介紹</a></li><li><a href="/coding-hub/blogs/Just_in_time_compiler/Part1.html" class="sidebar-link">Just In Time Compiler - Part 1. 認識 JIT 及建立簡單的(?) JIT</a></li><li><a href="/coding-hub/blogs/Just_in_time_compiler/Part2.html" class="sidebar-link">Just In Time Compiler - Part 2. Brainfuck compiler and Interpreter</a></li><li><a href="/coding-hub/blogs/Just_in_time_compiler/Part3.html" class="sidebar-link">Just In Time Compiler - Part 3. Brainfuck compiler and interpreter 比較與探討</a></li><li><a href="/coding-hub/blogs/Just_in_time_compiler/Part4.html" class="sidebar-link">Just In Time Compiler - Part 4. BF optimization - 讓我們進入加速的世界吧</a></li><li><a href="/coding-hub/blogs/Just_in_time_compiler/Part5.html" aria-current="page" class="active sidebar-link">Just In Time Compiler - Part 5. Cross Comparison - 效能大亂鬥</a></li><li><a href="/coding-hub/blogs/Just_in_time_compiler/Part6.html" class="sidebar-link">Just In Time Compiler - Part 6. Threaded Code - 跳出迴圈的魔咒</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Just In Time Compiler - Part 5. Cross Comparison - 效能大亂鬥</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Lawrence</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">Just In Time Compiler - Part 5. Cross Comparison - 效能大亂鬥</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Lawrence</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>5/19/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>JIT compiler</span><span class="tag-item" data-v-1ff7123e>Compiler</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="part-5-cross-comparison"><a href="#part-5-cross-comparison" class="header-anchor">#</a> Part 5. Cross Comparison</h1> <p>終於進入我們的最終章，一個大亂鬥的時代 ~</p> <p>進到 Part 5 資料夾，執行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就可以自動編譯所有的程式及輸出比較表格與圖片，
首先先來看輸出的表格以及圖片，很美吧😁</p> <div class="vuepress-chartjs"><canvas id="chart_382ee148" height="400"></canvas></div><table><thead><tr><th>Rank</th> <th>program</th> <th>real</th> <th>user</th> <th>system</th> <th>Execution Time</th></tr></thead> <tbody><tr><td>0</td> <td>interpreter</td> <td>2:18.71</td> <td>129.01</td> <td>0.14</td> <td>129.15</td></tr> <tr><td>1</td> <td>interpreter_opt1</td> <td>1:02.82</td> <td>61.48</td> <td>0.01</td> <td>61.49</td></tr> <tr><td>2</td> <td>interpreter_opt3</td> <td>0:53.23</td> <td>50.54</td> <td>0.12</td> <td>50.66</td></tr> <tr><td>3</td> <td>interpreter_opt2</td> <td>0:47.69</td> <td>46.79</td> <td>0.03</td> <td>46.82</td></tr> <tr><td>4</td> <td>sed</td> <td>0:19.47</td> <td>18.17</td> <td>0.03</td> <td>18.20</td></tr> <tr><td>5</td> <td>jit_opcode</td> <td>0:04.35</td> <td>3.89</td> <td>0.03</td> <td>3.92</td></tr> <tr><td>6</td> <td>compiler</td> <td>0:04.20</td> <td>3.85</td> <td>0.00</td> <td>3.85</td></tr> <tr><td>7</td> <td>jit_dynasm</td> <td>0:04.75</td> <td>3.81</td> <td>0.03</td> <td>3.84</td></tr> <tr><td>8</td> <td>jit_dynasm_opt2</td> <td>0:01.37</td> <td>1.25</td> <td>0.01</td> <td>1.26</td></tr> <tr><td>9</td> <td>jit_dynasm_opt1</td> <td>0:01.46</td> <td>1.25</td> <td>0.00</td> <td>1.25</td></tr> <tr><td>10</td> <td>sed_O2</td> <td>0:01.21</td> <td>1.20</td> <td>0.00</td> <td>1.20</td></tr> <tr><td>11</td> <td>sed_O1</td> <td>0:01.20</td> <td>1.17</td> <td>0.01</td> <td>1.18</td></tr> <tr><td>12</td> <td>sed_O3</td> <td>0:01.18</td> <td>1.17</td> <td>0.00</td> <td>1.17</td></tr></tbody></table> <p>可以發現我們從頭到尾的心路歷程，從最簡單的 interpreter 一路走到 JIT compiler，最後我們經過最佳化的JIT compiler 和 編譯器方法最佳化的速度幾乎一致，及時編譯器的效果很猛吧😁，接下來三個小節就來探討各個不同比較的組合。</p> <h2 id="_5-1-interpreter-家族"><a href="#_5-1-interpreter-家族" class="header-anchor">#</a> 5.1 Interpreter 家族</h2> <div class="vuepress-chartjs"><canvas id="chart_64a561da" height="400"></canvas></div><table><thead><tr><th>Rank</th> <th>program</th> <th>real</th> <th>user</th> <th>system</th> <th>Execution Time</th></tr></thead> <tbody><tr><td>0</td> <td>interpreter</td> <td>2:18.71</td> <td>129.01</td> <td>0.14</td> <td>129.15</td></tr> <tr><td>1</td> <td>interpreter_opt1</td> <td>1:02.82</td> <td>61.48</td> <td>0.01</td> <td>61.49</td></tr> <tr><td>2</td> <td>interpreter_opt3</td> <td>0:53.23</td> <td>50.54</td> <td>0.12</td> <td>50.66</td></tr> <tr><td>3</td> <td>interpreter_opt2</td> <td>0:47.69</td> <td>46.79</td> <td>0.03</td> <td>46.82</td></tr> <tr><td>4</td> <td>sed</td> <td>0:19.47</td> <td>18.17</td> <td>0.03</td> <td>18.20</td></tr></tbody></table> <p>可以發現，interpreter 先經由 jumptable 的優化後， <mark>效率直接提升一倍</mark> ，之後再加上<code>contineous_count</code> 的運算壓縮後，又快了大約 15 秒，而再加入處理 loop pattern 後，效率反而慢了一點點。但是這些都還沒有 sed 先轉成 C code 再編譯的方法快，<mark>原因是因為 interpreter 儘管最佳化，仍需要讀取 BF code 外，每個運算都要經過至少兩個 branch 的指令(for loop + switch case)，而編譯後的 sed 少了很多 branch 指令，自然而然指令數量少，執行效率也會加快很多</mark>，這就是為什麼 interpreter 仍然效率輸 sed 的方法的理由。</p> <h2 id="_5-2-最佳化-interpreter-vs-simple-dynasm-jit"><a href="#_5-2-最佳化-interpreter-vs-simple-dynasm-jit" class="header-anchor">#</a> 5.2 最佳化 Interpreter vs  Simple Dynasm JIT</h2> <div class="vuepress-chartjs"><canvas id="chart_64a55998" height="400"></canvas></div><table><thead><tr><th>Rank</th> <th>program</th> <th>real</th> <th>user</th> <th>system</th> <th>Execution Time</th></tr></thead> <tbody><tr><td>0</td> <td>interpreter_opt1</td> <td>1:02.82</td> <td>61.48</td> <td>0.01</td> <td>61.49</td></tr> <tr><td>1</td> <td>interpreter_opt3</td> <td>0:53.23</td> <td>50.54</td> <td>0.12</td> <td>50.66</td></tr> <tr><td>2</td> <td>interpreter_opt2</td> <td>0:47.69</td> <td>46.79</td> <td>0.03</td> <td>46.82</td></tr> <tr><td>3</td> <td>jit_dynasm</td> <td>0:04.75</td> <td>3.81</td> <td>0.03</td> <td>3.84</td></tr></tbody></table> <p>將 interpreter 引入了 JIT 的技術，在執行時間產生機器碼直接執行，可以看到，無論我們的直譯器做了多少最佳化，真的就是被 JIT 屌打😂。效率直接高了近 15 倍。所以 JIT compiler 的確可以幫我們大幅加速直譯器的執行效率😀。</p> <div class="custom-block tip"><p class="title"></p><p>你可能會覺得很奇怪，為何同樣是直譯的感覺，不是都是 for loop 後再 switch 執行對應的程式碼嗎 ?</p> <p>這裡我也想了很久，為何都是指令，p++ 跟 直接執行機器碼的加法執行的就差這麼多 ? 相信很多人都會誤以為就是網路上所說的「直接執行機器碼不用再重新翻譯所以比較快」，這句話是正確的，因為通常 JIT 的實作就是快取常用的機器碼，但在本篇的實作中，如同文章 <a href="https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-2-an-x64-jit/" target="_blank" rel="noopener noreferrer">Adventures in JIT compilation: Part 2 - an x64 JIT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 所述</p> <blockquote><p>The reason is that the baseline performance of the JIT is vastly better. I've mentioned this briefly in part 1 - imagine what's needed to interpret a single instruction in the fastest interpreter.</p> <ol><li>Advance pc and compare it to program size.</li> <li>Grab the instruction at pc.</li> <li>Switch on the value of the instruction to the right case.</li> <li>Execute the case.</li></ol> <p>This requires a whole sequence of machine instructions, with at least two branches (one for the loop, one for the switch). On the other hand, the JIT just emits a single instruction - no branches. I would say that - depending on what the compiler did while compiling the interpreter - the JIT is between 4 and 8 times faster at running any given BF operation. It has to run many more BF operations because it doesn't optimize, but this difference is insufficient to close the huge baseline gap. Later in this post we're going to see an optimized JIT which performs even better.</p></blockquote> <p>事實上， <mark>我們的實作方法是先用 for loop 掃一遍，將機器碼存在陣列裡，再用可執行的記憶區段去執行這段陣列</mark> ，而一般直譯器是每執行一個指令都要經過兩個 branch (for loop + switch)，才能真正執行到運算。因此假設 BF 的 code 是 <code>+++</code></p> <table><thead><tr><th>BF Interpreter</th> <th>Our BF JIT Compiler</th></tr></thead> <tbody><tr><td>jmp branch(loop)<br>jmp branch(switch)<br>add<br>jmp branch(loop)<br>jmp branch(switch)<br>add<br>jmp branch(loop)<br>jmp branch(switch)<br>add<br></td> <td>add<br>add<br>add<br></td></tr></tbody></table> <p><mark>所以相當於 JIT 先幫我們快速掃了一遍跟判斷，把指令存在一個陣列，再執行一段沒有 branch 的程式碼</mark> ， 那如同上表，在指令執行的數量上就差很多。一般直譯器可能因為邊讀邊執行，所以每只行一個動作都要多做幾個branch指令，一旦程式碼越大，效能整個就會被拖跨，而在我們 JIT 就是先一次非常快判斷掃一遍，去除所有 branch 的判斷，直接執行純粹的加減法指令，也就是在這裡 JIT 可以贏做一堆前處理、最佳化的直譯器的原因。
(備註 : Dynasm 幫我們把指令存起來再放入可執行記憶體區段執行，這篇<a href="https://blog.reverberate.org/2012/12/hello-jit-world-joy-of-simple-jits.html" target="_blank" rel="noopener noreferrer">文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 對於 Dynasm 講的蠻詳細的 )</p></div><p>::: info
這種直譯的 for loop 搭配 switch case 的 overhead 有個專有名詞叫做 <mark>dispatch loop 或 dynamic dispatch</mark>，如果像是 BF 這種比較簡單的直譯，那 dispatch 的成本佔執行時間的比例就會較大，而傳統會使用 threaded code 手法加速，這種加速手法會更明顯。這個方法之後會加入分析。也有做法是將全部程式碼都一次展開，如同本次 JIT 一樣，用空間換時間的方法，再用 threaded code 進行最佳化。
:::</p> <h2 id="_5-3-站在顛峰-最快的辣些人"><a href="#_5-3-站在顛峰-最快的辣些人" class="header-anchor">#</a> 5.3 站在顛峰 - 最快的辣些人</h2> <div class="vuepress-chartjs"><canvas id="chart_64a54ae2" height="400"></canvas></div><table><thead><tr><th>Rank</th> <th>program</th> <th>real</th> <th>user</th> <th>system</th> <th>Execution Time</th></tr></thead> <tbody><tr><td>0</td> <td>jit_opcode</td> <td>0:04.35</td> <td>3.89</td> <td>0.03</td> <td>3.92</td></tr> <tr><td>1</td> <td>compiler</td> <td>0:04.20</td> <td>3.85</td> <td>0.00</td> <td>3.85</td></tr> <tr><td>2</td> <td>jit_dynasm</td> <td>0:04.75</td> <td>3.81</td> <td>0.03</td> <td>3.84</td></tr> <tr><td>3</td> <td>jit_dynasm_opt2</td> <td>0:01.37</td> <td>1.25</td> <td>0.01</td> <td>1.26</td></tr> <tr><td>4</td> <td>jit_dynasm_opt1</td> <td>0:01.46</td> <td>1.25</td> <td>0.00</td> <td>1.25</td></tr> <tr><td>5</td> <td>sed_O2</td> <td>0:01.21</td> <td>1.20</td> <td>0.00</td> <td>1.20</td></tr> <tr><td>6</td> <td>sed_O1</td> <td>0:01.20</td> <td>1.17</td> <td>0.01</td> <td>1.18</td></tr> <tr><td>7</td> <td>sed_O3</td> <td>0:01.18</td> <td>1.17</td> <td>0.00</td> <td>1.17</td></tr></tbody></table> <p>在還沒做任何最佳化前(contineous_count, loop pattern)，我們實做的方法最多只能到4秒左右，但是加入了 Part4 提到的最佳化技術後，整體又快了3秒。執行效率1秒多。使得我們實做的 just in time compiler 逼近 clang 編譯器進行程式碼最佳化後的效率。很厲害吧!😉</p> <h2 id="_5-4-結尾和未來工作"><a href="#_5-4-結尾和未來工作" class="header-anchor">#</a> 5.4 結尾和未來工作</h2> <p>我們實作了不同的方法去執行運算量大的碎形 brainfuck 程式檔，最後利用及時編譯技術加上一些最佳化方法，把 <mark>普通的 interpreter 效率提升 120 倍</mark>，執行只需要 1 秒，可以說是非常值得使用及深入探討的技術。至於未來工作是加入 LLVM 及 asmjit 這兩個工具幫我們建立 JIT 編譯器，並且加入比較，且把組合語言的基礎打穩。</p> <h2 id="_5-5-參考連結-特別感謝的網站"><a href="#_5-5-參考連結-特別感謝的網站" class="header-anchor">#</a> 5.5 參考連結 (特別感謝的網站)</h2> <ol><li><p><a href="https://nickdesaulniers.github.io/blog/2015/05/25/interpreter-compiler-jit/" target="_blank" rel="noopener noreferrer">Interpreter, Compiler, JIT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://accu.cc/content/jit_tour/brainfuck_jit/" target="_blank" rel="noopener noreferrer">JIT 編譯器原理簡述/實現Brainfuck JIT 編譯器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://hackmd.io/@nKngvyhpQdGagg1V6GKLwA/HJjoxbvke?type=view#2016q3-Homework5---JIT-compiler" target="_blank" rel="noopener noreferrer">2016q3 Homework5 - JIT compiler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://hackmd.io/@sysprog/SkBsZoReb?type=view" target="_blank" rel="noopener noreferrer">虛擬機器設計與實作<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-1-an-interpreter/" target="_blank" rel="noopener noreferrer">Adventures in JIT compilation: Part 1 - an interpreter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-2-an-x64-jit/" target="_blank" rel="noopener noreferrer">Adventures in JIT compilation: Part 2 - an x64 JIT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">Fri Jul 09 2021 12:17:15 GMT+0800</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/coding-hub/blogs/Just_in_time_compiler/Part4.html" class="prev">
            Just In Time Compiler - Part 4. BF optimization - 讓我們進入加速的世界吧
          </a></span> <span class="next"><a href="/coding-hub/blogs/Just_in_time_compiler/Part6.html">
            Just In Time Compiler - Part 6. Threaded Code - 跳出迴圈的魔咒
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><!----><div class="vuepress-canvas-nest-element"></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/coding-hub/assets/js/app.df64d80b.js" defer></script><script src="/coding-hub/assets/js/6.5a677154.js" defer></script><script src="/coding-hub/assets/js/1.0bfbaed9.js" defer></script><script src="/coding-hub/assets/js/27.fa8870a1.js" defer></script><script src="/coding-hub/assets/js/11.c55c4bcd.js" defer></script>
  </body>
</html>

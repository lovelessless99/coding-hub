<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hello World Odyssey - Part 3. 好玩的動態鏈接 | Coding Hub</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/coding-hub/code.ico">
    <link rel="manifest" href="/coding-hub/manifest.json">
    <link rel="apple-touch-icon" href="/coding-hub/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/coding-hub/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Hello World">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/app_icons/192.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    
    <link rel="preload" href="/coding-hub/assets/css/0.styles.2277b98e.css" as="style"><link rel="preload" href="/coding-hub/assets/js/app.df64d80b.js" as="script"><link rel="preload" href="/coding-hub/assets/js/6.5a677154.js" as="script"><link rel="preload" href="/coding-hub/assets/js/1.0bfbaed9.js" as="script"><link rel="preload" href="/coding-hub/assets/js/17.f13925a9.js" as="script"><link rel="preload" href="/coding-hub/assets/js/11.c55c4bcd.js" as="script"><link rel="prefetch" href="/coding-hub/assets/js/10.153f0244.js"><link rel="prefetch" href="/coding-hub/assets/js/12.5069d591.js"><link rel="prefetch" href="/coding-hub/assets/js/13.288e3bf1.js"><link rel="prefetch" href="/coding-hub/assets/js/14.98923b0d.js"><link rel="prefetch" href="/coding-hub/assets/js/15.12c58ad1.js"><link rel="prefetch" href="/coding-hub/assets/js/16.0b588d4f.js"><link rel="prefetch" href="/coding-hub/assets/js/18.47e56f78.js"><link rel="prefetch" href="/coding-hub/assets/js/19.bf916fa9.js"><link rel="prefetch" href="/coding-hub/assets/js/20.a4e1868f.js"><link rel="prefetch" href="/coding-hub/assets/js/21.0e84c3fb.js"><link rel="prefetch" href="/coding-hub/assets/js/22.c39fdcb6.js"><link rel="prefetch" href="/coding-hub/assets/js/23.0e9db64a.js"><link rel="prefetch" href="/coding-hub/assets/js/24.1b64b869.js"><link rel="prefetch" href="/coding-hub/assets/js/25.bee36556.js"><link rel="prefetch" href="/coding-hub/assets/js/26.5f1157e4.js"><link rel="prefetch" href="/coding-hub/assets/js/27.fa8870a1.js"><link rel="prefetch" href="/coding-hub/assets/js/28.80c49a2c.js"><link rel="prefetch" href="/coding-hub/assets/js/29.b0305a5d.js"><link rel="prefetch" href="/coding-hub/assets/js/30.ee376dfa.js"><link rel="prefetch" href="/coding-hub/assets/js/31.2d302251.js"><link rel="prefetch" href="/coding-hub/assets/js/32.1e1bc032.js"><link rel="prefetch" href="/coding-hub/assets/js/33.72890909.js"><link rel="prefetch" href="/coding-hub/assets/js/34.fa67bc52.js"><link rel="prefetch" href="/coding-hub/assets/js/35.f74092dd.js"><link rel="prefetch" href="/coding-hub/assets/js/36.a847b223.js"><link rel="prefetch" href="/coding-hub/assets/js/37.1b012f6e.js"><link rel="prefetch" href="/coding-hub/assets/js/38.7628525e.js"><link rel="prefetch" href="/coding-hub/assets/js/39.f8aff88f.js"><link rel="prefetch" href="/coding-hub/assets/js/40.91e31a7c.js"><link rel="prefetch" href="/coding-hub/assets/js/41.d151ce20.js"><link rel="prefetch" href="/coding-hub/assets/js/42.824efee6.js"><link rel="prefetch" href="/coding-hub/assets/js/43.103899ed.js"><link rel="prefetch" href="/coding-hub/assets/js/44.4998e954.js"><link rel="prefetch" href="/coding-hub/assets/js/7.ff64a05d.js"><link rel="prefetch" href="/coding-hub/assets/js/8.9c5e7b1f.js"><link rel="prefetch" href="/coding-hub/assets/js/9.df73a708.js"><link rel="prefetch" href="/coding-hub/assets/js/vendors~flowchart.15880f81.js"><link rel="prefetch" href="/coding-hub/assets/js/vendors~mermaid.db8915cf.js"><link rel="prefetch" href="/coding-hub/assets/js/vendors~reveal.2eb356a7.js">
    <link rel="stylesheet" href="/coding-hub/assets/css/0.styles.2277b98e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Coding Hub</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>Less is more.</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Lawrence</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coding-hub/" class="home-link router-link-active"><img src="/coding-hub/coding.png" alt="Coding Hub" class="logo"> <span class="site-name">Coding Hub</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coding-hub/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding-hub/categories/ELF/" class="nav-link"><i class="undefined"></i>
  ELF
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/JIT compiler/" class="nav-link"><i class="undefined"></i>
  JIT compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/IEEE 754/" class="nav-link"><i class="undefined"></i>
  IEEE 754
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/AI Compiler/" class="nav-link"><i class="undefined"></i>
  AI Compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Pypy and Rpython/" class="nav-link"><i class="undefined"></i>
  Pypy and Rpython
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/LLVM/" class="nav-link"><i class="undefined"></i>
  LLVM
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Python Internal/" class="nav-link"><i class="undefined"></i>
  Python Internal
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Virtual Machine/" class="nav-link"><i class="undefined"></i>
  Virtual Machine
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/MLIR/" class="nav-link"><i class="undefined"></i>
  MLIR
</a></li></ul></div></div><div class="nav-item"><a href="/coding-hub/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/coding-hub/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/coding-hub/blogs/aboutme/aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  About me
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lovelessless99" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/chih-yu-hsu-06a0091b8/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-linkedin"></i>
  Linkedin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="mailto:lovelessless99@gmail.com" class="nav-link external"><i class="iconfont reco-mail"></i>
  Gmail
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/coding-hub/head.gif" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    Lawrence
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>22</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>16</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/coding-hub/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding-hub/categories/ELF/" class="nav-link"><i class="undefined"></i>
  ELF
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/JIT compiler/" class="nav-link"><i class="undefined"></i>
  JIT compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/IEEE 754/" class="nav-link"><i class="undefined"></i>
  IEEE 754
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/AI Compiler/" class="nav-link"><i class="undefined"></i>
  AI Compiler
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Pypy and Rpython/" class="nav-link"><i class="undefined"></i>
  Pypy and Rpython
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/LLVM/" class="nav-link"><i class="undefined"></i>
  LLVM
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Python Internal/" class="nav-link"><i class="undefined"></i>
  Python Internal
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/Virtual Machine/" class="nav-link"><i class="undefined"></i>
  Virtual Machine
</a></li><li class="dropdown-item"><!----> <a href="/coding-hub/categories/MLIR/" class="nav-link"><i class="undefined"></i>
  MLIR
</a></li></ul></div></div><div class="nav-item"><a href="/coding-hub/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/coding-hub/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/coding-hub/blogs/aboutme/aboutme.html" class="nav-link"><i class="iconfont reco-account"></i>
  About me
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lovelessless99" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.linkedin.com/in/chih-yu-hsu-06a0091b8/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-linkedin"></i>
  Linkedin
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="mailto:lovelessless99@gmail.com" class="nav-link external"><i class="iconfont reco-mail"></i>
  Gmail
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ELF</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/coding-hub/blogs/ELF/Introduction.html" class="sidebar-link">Hello World Odyssey - Part 0. Introduction</a></li><li><a href="/coding-hub/blogs/ELF/elf_format.html" class="sidebar-link">Hello World Odyssey - Part 1. 邂逅 ELF</a></li><li><a href="/coding-hub/blogs/ELF/symbol.html" class="sidebar-link">Hello World Odyssey - Part 2. 關於符號的大小事</a></li><li><a href="/coding-hub/blogs/ELF/dynamic.html" aria-current="page" class="active sidebar-link">Hello World Odyssey - Part 3. 好玩的動態鏈接</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Hello World Odyssey - Part 3. 好玩的動態鏈接</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>Lawrence</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2023
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">Hello World Odyssey - Part 3. 好玩的動態鏈接</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>Lawrence</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>6/8/2021</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>ELF</span><span class="tag-item" data-v-1ff7123e>Linker</span></i></div></div> <div class="theme-reco-content content__default"><p><img src="https://luomuxiaoxiao.com/images/got_plt.gif" alt=""></p> <h2 id="一、動態鏈接"><a href="#一、動態鏈接" class="header-anchor">#</a> 一、動態鏈接</h2> <p>在前面幾篇，我們講的鏈接都是屬於靜態鏈接(static linking)，鏈接(linking)是指讓一隻程式在呼叫函數或使用外部變數時知道要往哪裡找。但是在實際應用中，動態鏈接(dynamic linking) 較常被使用，一個例子就是C語言&lt;stdio.h&gt;中的 printf()，如果系統中所有要對終端輸出字串的程式都把printf的程式碼包含進原始碼再編譯，不僅會浪費磁碟空間（儲存了一大堆printf），程式同時執行時主記憶體也就被很多個 printf 函數所佔用。換句話說，如果鏈接器以靜態鏈接的方式，<mark>在記憶體內就會存在很多 printf 的拷貝，那為何不乾脆用一份重複使用就好呢 ?</mark></p> <p>靜態鏈結，鏈結後的可執行文件存在大量拷貝程式碼，浪費硬碟空間，執行時浪費記憶體</p> <div data-code="graph%20TD%0A%20%20%20%20subgraph%20pa%5Bs1.o%5D%0A%20%20%20%20%20%20%20%20p1(s1.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s1(printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pb%5Bs2.o%5D%0A%20%20%20%20%20%20%20%20p2(s2.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s2(printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pc%5Bs3.o%5D%0A%20%20%20%20%20%20%20%20p3(s3.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s3(printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20final%5Bprogram%5D%0A%20%20%20%20%20%20%20%20pp(s1.o%2C%20s2.o%2C%20s3.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s4(s1.o%20printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s5(s2.o%20printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s6(s3.o%20printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20p1%20--%3E%20pp%0A%20%20%20%20p2%20--%3E%20pp%0A%20%20%20%20p3%20--%3E%20pp%0A%0A%20%20%20%20s1%20--%3E%20s4%0A%20%20%20%20s2%20--%3E%20s5%0A%20%20%20%20s3%20--%3E%20s6%0A" class="md-mermaid-loading"><svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="background:0 0;display:block;shape-rendering:auto;"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate></circle></svg></div><p>當使用動態鏈結技術時，當使用到 <code>printf</code> 時，才去做動態鏈結到該程式碼區段，去 libc.so 的 printf 的程式碼執行後返回。動態鏈接可以使得多個程式共用函數，進而得到節省記憶體的效果。另外，在程式執行期才做函數地址解析的方法，稱為動態鏈接，也稱為延遲綁定(Lazy binding)。</p> <div data-code="graph%20TD%0A%20%20%20%20subgraph%20pa%5Bs1.o%5D%0A%20%20%20%20%20%20%20%20p1(s1.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC%20%2B%20%E5%BC%95%E7%94%A8%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pb%5Bs2.o%5D%0A%20%20%20%20%20%20%20%20p2(s2.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC%20%2B%20%E5%BC%95%E7%94%A8%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pc%5Bs3.o%5D%0A%20%20%20%20%20%20%20%20p3(s3.o%20%E7%A8%8B%E5%BC%8F%E7%A2%BC%20%2B%20%E5%BC%95%E7%94%A8%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20final%5Bprogram%5D%0A%20%20%20%20%20%20%20%20pp(s1.o%2C%20s2.o%2C%20s3.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20need(%E5%BC%95%E7%94%A8%E5%88%B0%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20lib.so%0A%20%20%20%20%20%20%20%20printf%0A%20%20%20%20end%20%0A%0A%20%20%20%20need%20--%3E%20printf%20%0A%20%20%20%20p1%20--%3E%20pp%0A%20%20%20%20p2%20--%3E%20pp%0A%20%20%20%20p3%20--%3E%20pp%0A" class="md-mermaid-loading"><svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="background:0 0;display:block;shape-rendering:auto;"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate></circle></svg></div><p>所以說比較有效率的方式是讓系統的主記憶體只存著一份printf函數，其他所有程式要輸出字串時讓CPU跳到唯一存放printf的地方執行，結束再跳回原來的程式就行了。<mark>之所以叫做動態，就是因為程式編譯時，並不會知道所呼叫的函數在哪裡，無法在編譯時「鏈接」，只能在程式從硬碟載入記憶體時動態地在系統的幫助下完成鏈接。</mark></p> <p>為了保證程式碼重複使用和節省系統資源，在鏈接時，動態鏈接庫的 .rodata section 和 .data section 等是不會被複製到最終生成的可執行檔案中，這些部分會在程序載入的時候複製到記憶體，並做動態鏈接，使原來可執行文件能夠對其中定義的符號正常引用。也就是說在這個時候，可執行檔案的程式碼區段(.text section)中對動態鏈接函式庫包含的符號引用的地址才真正確定下來。另外對動態鏈接還有一個好處，就是在更新函式庫的時候更方便，因為是在執行時才會解析函數地址，所以基本上不用像靜態鏈結一樣重新編譯，直接替換即可。</p> <p>另外一個容易搞混的名詞是動態載入 ( Dynamic Loading )，動態鏈結是把需要的函式庫在載入時就放進記憶體。那動態載入是利用 <code>dlopen</code> 在執行期間動態載入函式庫到記憶體，兩者的差別是在載入函式庫的時機點。</p> <p>總結動態鏈接相對於靜態鏈接的優點</p> <ul><li>更新函式庫更方便，不用重新編譯</li> <li>省硬碟、記憶體空間</li></ul> <h2 id="二、兩大主角-got-和-plt"><a href="#二、兩大主角-got-和-plt" class="header-anchor">#</a> 二、兩大主角 - GOT 和 PLT</h2> <ol><li><p>GOT (Global Offset Table)</p> <p>GOT存著很多個一樣大小的元素，形成一個table(基本上就是array)。每個元素都是一個指標(所以說32位元機器一個元素4個bytes，64位元就是8個bytes)，指向程式所需要的變數或者是函數，也有可能是系統需要的指標。<mark>簡單來說，就是一個存指向函數、變數指標的一維陣列。</mark></p></li> <li><p>PLT (Procedure Linkage Table)</p> <p>PLT存著很多個一樣大小的元素，形成一個table(基本上就是array)。 <mark>每個元素都是一小段程式碼</mark> ，第一個元素是公共plt，負責呼叫動態鏈接器。從第二個開始每個元素分別對應到一個動態鏈接的函數，會使用該函數所對應之GOT元素。</p></li></ol> <p>以上兩個主角的內容，之後會用 <code>Debugger</code> 搭配 <code>readelf</code> 展示給大家看。</p> <p>printf 的動態鏈接流程如下</p> <p><img src="https://img.cntofu.com/book/note/linked_and_loader/images/plt_after.png" alt=""></p> <div data-code="graph%20LR%0A%20%20%20%20printf%5B%22call%20printf%22%5D%20--%3E%20PLT%20--%3E%7C%E5%8E%BB%E6%9F%A5%20GOT%20%E5%B0%8D%E6%87%89%E7%B4%A2%E5%BC%95%E7%9A%84%E9%A0%85%E7%9B%AE%7C%20GOT%0A%20%20%20%20GOT%20--%3E%20add%7B%E8%A9%B2%E9%A0%85%E6%9C%89%E5%87%BD%E6%95%B8%E5%9C%B0%E5%9D%80%3F%7D%20--%3E%7CYes%7C%20Success(%E8%B7%B3%E5%88%B0%E8%A9%B2%E5%87%BD%E6%95%B8%E5%9C%B0%E5%9D%80%E5%9F%B7%E8%A1%8C)%0A%20%20%20%20add%20--%3E%20%7CNo%7C%20fail%5B_dl_runtime_resolve%5D%20--%3E%20update%5B%E6%9B%B4%E6%96%B0%20GOT%20table%20%E5%B0%8D%E6%87%89%E7%B4%A2%E5%BC%95%E8%A9%B2%E5%89%9B%E5%89%9B%E8%A7%A3%E6%9E%90%E7%9A%84%E5%87%BD%E6%95%B8%E5%9C%B0%E5%9D%80%5D%20--%3E%20Success%0A" class="md-mermaid-loading"><svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="background:0 0;display:block;shape-rendering:auto;"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate></circle></svg></div><p>如果寫成 pseudo code ( 感謝 <a href="https://www.usenix.net/sites/default/files/conference/protected-files/sec15_slides_difederico.pdf" target="_blank" rel="noopener noreferrer">How the ELF ruined Christmas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
提供的程式碼 )</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> printf@<span class="token function">plt</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> 是第一次呼叫 <span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
                <span class="token comment">// 找到 printf 地址，將地址更新到 GOT 表，再呼叫 PLT</span>
                <span class="token function">_dl_runtime_resolve</span><span class="token punctuation">(</span>elf_info<span class="token punctuation">,</span>printf_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
                <span class="token comment">// 直接跳到有放 printf 地址的 GOT 表，並跳到該項內 printf 地址執行</span>
                jmp <span class="token operator">*</span><span class="token punctuation">(</span>printf_got_entry<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>由上面所述，你可以發現 <mark>GOT 就是快取的功能</mark> ，當 GOT 表沒有地址 (快取沒有命中)，就要用動態鏈接器去找地址並更新 GOT 表，那如果有的話就是快取命中。就直接跳到存在 GOT 元素內的函數地址執行。因此，以這個流程來說，第一次解析通常會比較慢，因為 GOT表沒有地址，要呼叫動態鏈接器執行地址解析與GOT更新，但是第二次呼叫相同的函數時，因為GOT表已經有函數地址，直接跳過去函數地址執行就好，所以第一次之後速度會變比較快。</p> <p>如下圖，下圖左，是第一次 Call function，右是之後 Call 同 function，其實可以發現，當 <mark>GOT 若是沒有放該函數地址時，裡面的內容就是 PLT 的下一行指令，之後 PLT 會跳到 PLT 內動態鏈接的索引去執行動態鏈接</mark>，這張圖很清楚地涵蓋整個動態鏈接的精華。</p> <p>另外一張圖，也闡述的蠻清楚的，來自<a href="https://hackmd.io/@rhythm/ry5pxN6NI" target="_blank" rel="noopener noreferrer">Linux/ELF動態鏈接部分機制(GOT&amp;PLT)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，需要照數字走
|<img src="https://i.imgur.com/sxo16t3.png" alt=""></p> <ol><li>call printf 函數，跳到 PLT[1] (2 的位置)</li> <li>PLT[1] 是一段程式碼 ( PLT 內每個元素都是一些跳轉指令 )</li> <li>程式碼第一行先跳到 GOT[2] 的地址，看看 GOT[2] 有沒有存 printf 的地址，結果沒有 printf 的地址， GOT[2]裡面放的是 PLT[1] 下一行程式碼，跳回去 PLT[1] 的下一行程式碼 (4的位置)</li> <li>再跳去 PLT[0] ( 5 的位置 )，因為那裡有動態鏈接器的地址</li> <li>PLT[0] 起始地址</li> <li>呼叫動態鏈接器解析函數地址</li> <li>更新 GOT[2] 的內容變成 pritnf 的地址</li> <li>以後，當 call printf 時，去 GOT[2] 找就可以直接跳到 printf 的地址執行</li></ol> <p>講完了 printf 的故事，那為何需要 PLT 表格 ? 為何不直接去 GOT 表格找地址，如果GOT表沒有存就直接叫動態鏈接器就好 ?  為何要多此一舉的經過 PLT 再 GOT ? 🤔🤔，這個問題在 Stackoverflow 有人在討論，在 <a href="http://brandon-hy-lin.blogspot.com/2015/12/shared-library-plt-got.html" target="_blank" rel="noopener noreferrer">Shared Library 中 PLT 和 GOT 的使用機制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和  <a href="https://stackoverflow.com/questions/43048932/why-does-the-plt-exist-in-addition-to-the-got-instead-of-just-using-the-got" target="_blank" rel="noopener noreferrer">Why does the PLT exist in addition to the GOT, instead of just using the GOT?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
有提到，但是我認為都沒有回答到點上😂，這個問題我放在未解之謎。</p> <p>接下來就是運用到我們的 debugger 來看動態鏈接的過程。</p> <h2 id="三、debugger-實驗"><a href="#三、debugger-實驗" class="header-anchor">#</a> 三、Debugger 實驗</h2> <p>在這裡我們使用進階的 <code>gdb-peda</code>，因為原始的 <code>gdb</code> 雖然夠用，但是 <code>gdb-peda</code> 可以更鉅細靡遺的展示各個暫存器資訊，執行狀態等，是個常常在逆向工程使用到的進階 debugger。安裝也是粉簡單</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/longld/peda.git ~/peda
<span class="token builtin class-name">echo</span> <span class="token string">&quot;source ~/peda/peda.py&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.gdbinit
<span class="token builtin class-name">echo</span> <span class="token string">&quot;DONE! debug your program with gdb and enjoy&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>那我們就以普通的 hello world 的程式碼來分析吧 ~</p> <div class="language-C line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-1-利用-readelf-看-eof-的格局及重定位符號"><a href="#_3-1-利用-readelf-看-eof-的格局及重定位符號" class="header-anchor">#</a> 3-1. 利用 Readelf 看 EOF 的格局及重定位符號</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>readelf -l hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-text"><code>Elf file type is DYN (Shared object file)
Entry point 0x530
There are 9 program headers, starting at offset 64

Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040
                 0x00000000000001f8 0x00000000000001f8  R      0x8
  INTERP         0x0000000000000238 0x0000000000000238 0x0000000000000238
                 0x000000000000001c 0x000000000000001c  R      0x1
      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000
                 0x00000000000008b0 0x00000000000008b0  R E    0x200000
  LOAD           0x0000000000000db8 0x0000000000200db8 0x0000000000200db8
                 0x0000000000000258 0x0000000000000260  RW     0x200000
  DYNAMIC        0x0000000000000dc8 0x0000000000200dc8 0x0000000000200dc8
                 0x00000000000001f0 0x00000000000001f0  RW     0x8
  NOTE           0x0000000000000254 0x0000000000000254 0x0000000000000254
                 0x0000000000000044 0x0000000000000044  R      0x4
  GNU_EH_FRAME   0x0000000000000768 0x0000000000000768 0x0000000000000768
                 0x000000000000003c 0x000000000000003c  R      0x4
  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000
                 0x0000000000000000 0x0000000000000000  RW     0x10
  GNU_RELRO      0x0000000000000db8 0x0000000000200db8 0x0000000000200db8
                 0x0000000000000248 0x0000000000000248  R      0x1

 Section to Segment mapping:
  Segment Sections...
   00
   01     .interp
   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame
   03     .init_array .fini_array .dynamic .got .data .bss
   04     .dynamic
   05     .note.ABI-tag .note.gnu.build-id
   06     .eh_frame_hdr
   07
   08     .init_array .fini_array .dynamic .got
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>上面可以看到，哪幾個 section 屬於同一個 segment，例如 <code>.got</code>、<code>.data</code>、<code>.bss</code> 屬於同一個 Segment ，再來我們看看有哪些符號需要被重定位</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>readelf -r hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>Relocation section '.rela.dyn' at offset 0x410 contains 8 entries:
  Offset          Info           Type           Sym. Value    Sym. Name + Addend
000000200db8  000000000008 R_X86_64_RELATIVE                    630
000000200dc0  000000000008 R_X86_64_RELATIVE                    5f0
000000201008  000000000008 R_X86_64_RELATIVE                    201008
000000200fd8  000100000006 R_X86_64_GLOB_DAT 0000000000000000 _ITM_deregisterTMClone + 0
000000200fe0  000300000006 R_X86_64_GLOB_DAT 0000000000000000 __libc_start_main@GLIBC_2.2.5 + 0
000000200fe8  000400000006 R_X86_64_GLOB_DAT 0000000000000000 __gmon_start__ + 0
000000200ff0  000500000006 R_X86_64_GLOB_DAT 0000000000000000 _ITM_registerTMCloneTa + 0
000000200ff8  000600000006 R_X86_64_GLOB_DAT 0000000000000000 __cxa_finalize@GLIBC_2.2.5 + 0

Relocation section '.rela.plt' at offset 0x4d0 contains 1 entry:
  Offset          Info           Type           Sym. Value    Sym. Name + Addend
000000200fd0  000200000007 R_X86_64_JUMP_SLO 0000000000000000 puts@GLIBC_2.2.5 + 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>這個指令可以查看什麼符號需要被重定位，例如 : puts 等。而為了讓動態鏈接器確定是對哪個符號進行重定位，需要一個重定位表來儲存相關訊息
<code>.rela.plt</code>：這個section保存了.plt中保存的符號的重定位信息。
<code>.rela.dyn</code>：這個section保存了除了.plt中保存的符號外的其他符號的重定位信息。</p> <p>由上面 <code>readelf</code>，可以看到各個section 的訊息，也可以看到我們以那些符號需要重定位，接下來我們需要再拉近一點距離看，會使用到 <code>objdump</code></p> <h3 id="_3-2-利用-objdump-更仔細看-plt-got-機制"><a href="#_3-2-利用-objdump-更仔細看-plt-got-機制" class="header-anchor">#</a> 3-2. 利用 objdump 更仔細看 PLT, GOT 機制</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>objdump -D hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>hello:     file format elf64-x86-64


Disassembly of section .init:

00000000000004e8 &lt;_init&gt;:
 4e8:   48 83 ec 08             sub    $0x8,%rsp
 4ec:   48 8b 05 f5 0a 20 00    mov    0x200af5(%rip),%rax        # 200fe8 &lt;__gmon_start__&gt;
 4f3:   48 85 c0                test   %rax,%rax
 4f6:   74 02                   je     4fa &lt;_init+0x12&gt;
 4f8:   ff d0                   callq  *%rax
 4fa:   48 83 c4 08             add    $0x8,%rsp
 4fe:   c3                      retq

Disassembly of section .plt:

0000000000000500 &lt;.plt&gt;:
 500:   ff 35 ba 0a 20 00       pushq  0x200aba(%rip)        # 200fc0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;
 506:   ff 25 bc 0a 20 00       jmpq   *0x200abc(%rip)        # 200fc8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;
 50c:   0f 1f 40 00             nopl   0x0(%rax)

0000000000000510 &lt;puts@plt&gt;:
 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 &lt;puts@GLIBC_2.2.5&gt;
 516:   68 00 00 00 00          pushq  $0x0
 51b:   e9 e0 ff ff ff          jmpq   500 &lt;.plt&gt;

Disassembly of section .plt.got:

0000000000000520 &lt;__cxa_finalize@plt&gt;:
 520:   ff 25 d2 0a 20 00       jmpq   *0x200ad2(%rip)        # 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;
 526:   66 90                   xchg   %ax,%ax

Disassembly of section .text:

0000000000000530 &lt;_start&gt;:
 530:   31 ed                   xor    %ebp,%ebp
 532:   49 89 d1                mov    %rdx,%r9
 535:   5e                      pop    %rsi
 536:   48 89 e2                mov    %rsp,%rdx
 539:   48 83 e4 f0             and    $0xfffffffffffffff0,%rsp
 53d:   50                      push   %rax
 53e:   54                      push   %rsp
 53f:   4c 8d 05 8a 01 00 00    lea    0x18a(%rip),%r8        # 6d0 &lt;__libc_csu_fini&gt;
 546:   48 8d 0d 13 01 00 00    lea    0x113(%rip),%rcx        # 660 &lt;__libc_csu_init&gt;
 54d:   48 8d 3d e6 00 00 00    lea    0xe6(%rip),%rdi        # 63a &lt;main&gt;
 554:   ff 15 86 0a 20 00       callq  *0x200a86(%rip)        # 200fe0 &lt;__libc_start_main@GLIBC_2.2.5&gt;
 55a:   f4                      hlt
 55b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)

0000000000000560 &lt;deregister_tm_clones&gt;:
 560:   48 8d 3d a9 0a 20 00    lea    0x200aa9(%rip),%rdi        # 201010 &lt;__TMC_END__&gt;
 567:   55                      push   %rbp
 568:   48 8d 05 a1 0a 20 00    lea    0x200aa1(%rip),%rax        # 201010 &lt;__TMC_END__&gt;
 56f:   48 39 f8                cmp    %rdi,%rax
 572:   48 89 e5                mov    %rsp,%rbp
 575:   74 19                   je     590 &lt;deregister_tm_clones+0x30&gt;
 577:   48 8b 05 5a 0a 20 00    mov    0x200a5a(%rip),%rax        # 200fd8 &lt;_ITM_deregisterTMCloneTable&gt;
 57e:   48 85 c0                test   %rax,%rax
 581:   74 0d                   je     590 &lt;deregister_tm_clones+0x30&gt;
 583:   5d                      pop    %rbp
 584:   ff e0                   jmpq   *%rax
 586:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)
 58d:   00 00 00
 590:   5d                      pop    %rbp
 591:   c3                      retq
 592:   0f 1f 40 00             nopl   0x0(%rax)
 596:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)
 59d:   00 00 00

00000000000005a0 &lt;register_tm_clones&gt;:
 5a0:   48 8d 3d 69 0a 20 00    lea    0x200a69(%rip),%rdi        # 201010 &lt;__TMC_END__&gt;
 5a7:   48 8d 35 62 0a 20 00    lea    0x200a62(%rip),%rsi        # 201010 &lt;__TMC_END__&gt;
 5ae:   55                      push   %rbp
 5af:   48 29 fe                sub    %rdi,%rsi
 5b2:   48 89 e5                mov    %rsp,%rbp
 5b5:   48 c1 fe 03             sar    $0x3,%rsi
 5b9:   48 89 f0                mov    %rsi,%rax
 5bc:   48 c1 e8 3f             shr    $0x3f,%rax
 5c0:   48 01 c6                add    %rax,%rsi
 5c3:   48 d1 fe                sar    %rsi
 5c6:   74 18                   je     5e0 &lt;register_tm_clones+0x40&gt;
 5c8:   48 8b 05 21 0a 20 00    mov    0x200a21(%rip),%rax        # 200ff0 &lt;_ITM_registerTMCloneTable&gt;
 5cf:   48 85 c0                test   %rax,%rax
 5d2:   74 0c                   je     5e0 &lt;register_tm_clones+0x40&gt;
 5d4:   5d                      pop    %rbp
 5d5:   ff e0                   jmpq   *%rax
 5d7:   66 0f 1f 84 00 00 00    nopw   0x0(%rax,%rax,1)
 5de:   00 00
 5e0:   5d                      pop    %rbp
 5e1:   c3                      retq
 5e2:   0f 1f 40 00             nopl   0x0(%rax)
 5e6:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)
 5ed:   00 00 00

00000000000005f0 &lt;__do_global_dtors_aux&gt;:
 5f0:   80 3d 19 0a 20 00 00    cmpb   $0x0,0x200a19(%rip)        # 201010 &lt;__TMC_END__&gt;
 5f7:   75 2f                   jne    628 &lt;__do_global_dtors_aux+0x38&gt;
 5f9:   48 83 3d f7 09 20 00    cmpq   $0x0,0x2009f7(%rip)        # 200ff8 &lt;__cxa_finalize@GLIBC_2.2.5&gt;
 600:   00
 601:   55                      push   %rbp
 602:   48 89 e5                mov    %rsp,%rbp
 605:   74 0c                   je     613 &lt;__do_global_dtors_aux+0x23&gt;
 607:   48 8b 3d fa 09 20 00    mov    0x2009fa(%rip),%rdi        # 201008 &lt;__dso_handle&gt;
 60e:   e8 0d ff ff ff          callq  520 &lt;__cxa_finalize@plt&gt;
 613:   e8 48 ff ff ff          callq  560 &lt;deregister_tm_clones&gt;
 618:   c6 05 f1 09 20 00 01    movb   $0x1,0x2009f1(%rip)        # 201010 &lt;__TMC_END__&gt;
 61f:   5d                      pop    %rbp
 620:   c3                      retq
 621:   0f 1f 80 00 00 00 00    nopl   0x0(%rax)
 628:   f3 c3                   repz retq
 62a:   66 0f 1f 44 00 00       nopw   0x0(%rax,%rax,1)

0000000000000630 &lt;frame_dummy&gt;:
 630:   55                      push   %rbp
 631:   48 89 e5                mov    %rsp,%rbp
 634:   5d                      pop    %rbp
 635:   e9 66 ff ff ff          jmpq   5a0 &lt;register_tm_clones&gt;

000000000000063a &lt;main&gt;:
 63a:   55                      push   %rbp
 63b:   48 89 e5                mov    %rsp,%rbp
 63e:   48 8d 3d 9f 00 00 00    lea    0x9f(%rip),%rdi        # 6e4 &lt;_IO_stdin_used+0x4&gt;
 645:   e8 c6 fe ff ff          callq  510 &lt;puts@plt&gt;
 64a:   b8 00 00 00 00          mov    $0x0,%eax
 64f:   5d                      pop    %rbp
 650:   c3                      retq
 651:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)
 658:   00 00 00
 65b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)

0000000000000660 &lt;__libc_csu_init&gt;:
 660:   41 57                   push   %r15
 662:   41 56                   push   %r14
 664:   49 89 d7                mov    %rdx,%r15
 667:   41 55                   push   %r13
 669:   41 54                   push   %r12
 66b:   4c 8d 25 46 07 20 00    lea    0x200746(%rip),%r12        # 200db8 &lt;__frame_dummy_init_array_entry&gt;
 672:   55                      push   %rbp
 673:   48 8d 2d 46 07 20 00    lea    0x200746(%rip),%rbp        # 200dc0 &lt;__init_array_end&gt;
 67a:   53                      push   %rbx
 67b:   41 89 fd                mov    %edi,%r13d
 67e:   49 89 f6                mov    %rsi,%r14
 681:   4c 29 e5                sub    %r12,%rbp
 684:   48 83 ec 08             sub    $0x8,%rsp
 688:   48 c1 fd 03             sar    $0x3,%rbp
 68c:   e8 57 fe ff ff          callq  4e8 &lt;_init&gt;
 691:   48 85 ed                test   %rbp,%rbp
 694:   74 20                   je     6b6 &lt;__libc_csu_init+0x56&gt;
 696:   31 db                   xor    %ebx,%ebx
 698:   0f 1f 84 00 00 00 00    nopl   0x0(%rax,%rax,1)
 69f:   00
 6a0:   4c 89 fa                mov    %r15,%rdx
 6a3:   4c 89 f6                mov    %r14,%rsi
 6a6:   44 89 ef                mov    %r13d,%edi
 6a9:   41 ff 14 dc             callq  *(%r12,%rbx,8)
 6ad:   48 83 c3 01             add    $0x1,%rbx
 6b1:   48 39 dd                cmp    %rbx,%rbp
 6b4:   75 ea                   jne    6a0 &lt;__libc_csu_init+0x40&gt;
 6b6:   48 83 c4 08             add    $0x8,%rsp
 6ba:   5b                      pop    %rbx
 6bb:   5d                      pop    %rbp
 6bc:   41 5c                   pop    %r12
 6be:   41 5d                   pop    %r13
 6c0:   41 5e                   pop    %r14
 6c2:   41 5f                   pop    %r15
 6c4:   c3                      retq
 6c5:   90                      nop
 6c6:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)
 6cd:   00 00 00

00000000000006d0 &lt;__libc_csu_fini&gt;:
 6d0:   f3 c3                   repz retq

Disassembly of section .fini:

00000000000006d4 &lt;_fini&gt;:
 6d4:   48 83 ec 08             sub    $0x8,%rsp
 6d8:   48 83 c4 08             add    $0x8,%rsp
 6dc:   c3                      retq
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br></div></div><p>雖然產生出一大串文字，但是仔細看，我們可以發現一些蛛絲馬跡，首先 <code>&lt;main&gt;</code></p> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-text"><code>000000000000063a &lt;main&gt;:
 63a:   55                      push   %rbp
 63b:   48 89 e5                mov    %rsp,%rbp
 63e:   48 8d 3d 9f 00 00 00    lea    0x9f(%rip),%rdi        # 6e4 &lt;_IO_stdin_used+0x4&gt;
 645:   e8 c6 fe ff ff          callq  510 &lt;puts@plt&gt;
 64a:   b8 00 00 00 00          mov    $0x0,%eax
 64f:   5d                      pop    %rbp
 650:   c3                      retq
 651:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)
 658:   00 00 00
 65b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>call 510 &lt;puts@plt&gt;</code>: 跳到 PLT 表 510 的位置，接下來就是關鍵所在😀</p> <p>我們先看 PLT 表格，每一個元素真的都是放一段指令碼，而且大同小異，短短三行涵蓋精隨，在第一個元素 <code>&lt;.plt&gt;</code>，就是去呼叫 resolver 的指令，</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>objdump -d -j .plt hello 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-text"><code>Disassembly of section .plt:

0000000000000500 &lt;.plt&gt;:
 500:   ff 35 ba 0a 20 00       pushq  0x200aba(%rip)        # 200fc0 &lt;_GLOBAL_OFFSET_TABLE_+0x8&gt;
 506:   ff 25 bc 0a 20 00       jmpq   *0x200abc(%rip)        # 200fc8 &lt;_GLOBAL_OFFSET_TABLE_+0x10&gt;
 50c:   0f 1f 40 00             nopl   0x0(%rax)

0000000000000510 &lt;puts@plt&gt;:
 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 &lt;puts@GLIBC_2.2.5&gt;
 516:   68 00 00 00 00          pushq  $0x0
 51b:   e9 e0 ff ff ff          jmpq   500 &lt;.plt&gt;
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>所以你看第二個元素</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>0000000000000510 &lt;puts@plt&gt;:
 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 &lt;puts@GLIBC_2.2.5&gt;
 516:   68 00 00 00 00          pushq  $0x0
 51b:   e9 e0 ff ff ff          jmpq   500 &lt;.plt&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第一行，當 GOT 表格內容有 put 函數地址，就跳過去 put 地址執行，那 GOT 表格該項的地址由 <code>*0x200aba(%rip)</code> 得到，這行指令是 rip 值 + <code>0x200aba</code>， <mark>rip 暫存器值是下一個執行指令的地址</mark>，以這裡為例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>0x516 + 0x200aba = 0x200fd0 = 我們要去 GOT 找的項目地址，可能是 GOT[1], GOT[2]... 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>第二、三行，就是當 GOT 表項內存的是 0x516，表示沒有該符號的地址， <mark>我們就必須跳回來執行，因為要去找動態鏈接器的地址</mark>，那如同前面所述，動態鏈接器通常就在 PLT 表格的第一項，所以可以看到有 <code>jmpq 500 &lt;.plt&gt;</code>，又跳到 PLT 第一項，去找我們的動態鏈接器求救。</p> <p>那我們去循線找看看，GOT表的內容物吧</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>objdump -d -j .got hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>hello:     file format elf64-x86-64
Disassembly of section .got:

0000000000200fb8 &lt;_GLOBAL_OFFSET_TABLE_&gt;:
  200fb8:       c8 0d 20 00 00 00 00 00 00 00 00 00 00 00 00 00     .. .............
        ...
  200fd0:       16 05 00 00 00 00 00 00 00 00 00 00 00 00 00 00     ................
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>你會發現有兩個項目</p> <ul><li>GOT[0]: 200fb8: c8 0d 20 00 00 00 00 00 00 00 00 00 00 00 00 00</li> <li>GOT[1]: 200fd0: 16 05 00 00 00 00 00 00 00 00 00 00 00 00 00 00</li></ul> <p>在剛剛 PLT 表格，我們剛剛計算他跳到的地址是</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>0x516 + 0x200aba = 0x200fd0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就是我們 GOT[1] 那項，該內容是 <code>0x516</code>，0x516 是哪裡 ? 就是剛剛 PLT 的指令地址</p> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br></div><pre class="language-text"><code>0000000000000510 &lt;puts@plt&gt;:
 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 &lt;puts@GLIBC_2.2.5&gt;
 516:   68 00 00 00 00          pushq  $0x0
 51b:   e9 e0 ff ff ff          jmpq   500 &lt;.plt&gt;
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>是不是串起來了 ? 當 GOT 內沒有函數地址，就會叫你跳回去找動態鏈接器。</p> <p>所以流程就是</p> <div data-code="graph%20TD%0A%20%20%20%20main(%22645%3A%20%20%20e8%20c6%20fe%20ff%20ff%20%20%20%20%20%20%20%20%20%20callq%20%20510%20%3Cputs%40plt%3E%22)%0A%20%20%20%20plt1(%22510%3A%20%20%20ff%2025%20ba%200a%2020%2000%20%20%20%20%20%20%20jmpq%20%20%20*0x200aba(%25rip)%20%20%20%20%20%20%20%20%23%20200fd0%20%3Cbr%3E516%3A%20%20%2068%2000%2000%2000%2000%20%20%20%20%20%20%20%20%20%20pushq%20%20%240x0%20%3Cbr%3E%2051b%3A%20%20%20e9%20e0%20ff%20ff%20ff%20%20%20%20%20%20%20%20%3Cbr%3Ejmpq%20%20%20500%20%3C.plt%3E%22)%0A%20%20%20%20got(%22GOT%5B1%5D%3A%20200fd0%3A%2016%2005%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%22)%0A%20%20%20%20main%20--%3E%7C1.%200x510%7C%20plt1%20--%3E%7C2.%200x200fd0%7C%20got%20--%3E%20%7C3.%200x516%7C%20plt1%0A%20%20%20%20plt1%20--%3E%7C4.%200x516%7C%20plt2(%220000000000000500%20%3C.plt%3E...%22)%20--%3E%20dl(%22dynamic%20linker%22)%0A%20%20%20%20dl%20--%3E%20%7C%225.%20%E6%89%BE%E5%88%B0%E5%9C%B0%E5%9D%80%E6%9B%B4%E6%96%B0GOT%5B1%5D%22%7C%20got%0A%20%20%20%20dl%20--%3E%20exec(%22%E5%9F%B7%E8%A1%8C%20put%20%E5%87%BD%E6%95%B8%22)%0A" class="md-mermaid-loading"><svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" style="background:0 0;display:block;shape-rendering:auto;"><circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.3333333333333333s"></animate></circle> <circle cx="50" cy="50" r="0" fill="none" stroke="currentColor" stroke-width="2"><animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate> <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.6666666666666666s"></animate></circle></svg></div><p>利用 <code>objdump</code> 後，我們又更了解他的跳轉原理。😉</p> <h3 id="_3-3-利用-gdb-peda-動手追蹤"><a href="#_3-3-利用-gdb-peda-動手追蹤" class="header-anchor">#</a> 3-3. 利用 gdb-peda 動手追蹤</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>gdb ./hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我們先來在 main 函數下斷點</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>b *main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再執行</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>r
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://i.imgur.com/FciAF2i.png" alt="">
有沒有看到美麗的儀表板🤣，接下來就可以利用 <code>gdb-peda</code> 的強大的功能了，接下來我們來反組譯 <code>put</code> 那行，這一行就是跳轉到 PLT 的指令。</p> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-text"><code>   0x8000631 &lt;frame_dummy+1&gt;:   mov    rbp,rsp
   0x8000634 &lt;frame_dummy+4&gt;:   pop    rbp
   0x8000635 &lt;frame_dummy+5&gt;:   jmp    0x80005a0 &lt;register_tm_clones&gt;
=&gt; 0x800063a &lt;main&gt;:    push   rbp
   0x800063b &lt;main+1&gt;:  mov    rbp,rsp
   0x800063e &lt;main+4&gt;:  lea    rdi,[rip+0x9f]        # 0x80006e4
   0x8000645 &lt;main+11&gt;: call   0x8000510 &lt;puts@plt&gt;
   0x800064a &lt;main+16&gt;: mov    eax,0x0
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>你可以發現在上一章節的地址 0x510，那因為載入到記憶體起始位置有改變，所以要平移，<code>3-1</code> 和 <code>3-2</code> 起始位置是 0，因為還沒載入到記憶體，但是載入後，起始位置是 <code>0x8000510</code>。</p> <div class="language- line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>gdb-peda$ pdisass 0x8000510
Dump of assembler code from 0x8000510 to 0x8000530::    Dump of assembler code from 0x8000510 to 0x8000530:
   0x0000000008000510 &lt;puts@plt+0&gt;:     jmp    QWORD PTR [rip+0x200aba]        # 0x8200fd0
   0x0000000008000516 &lt;puts@plt+6&gt;:     push   0x0
   0x000000000800051b &lt;puts@plt+11&gt;:    jmp    0x8000500
   0x0000000008000520 &lt;__cxa_finalize@plt+0&gt;:   jmp    QWORD PTR [rip+0x200ad2]        # 0x8200ff8
   0x0000000008000526 &lt;__cxa_finalize@plt+6&gt;:   xchg   ax,ax
   0x0000000008000528:  add    BYTE PTR [rax],al
   0x000000000800052a:  add    BYTE PTR [rax],al
   0x000000000800052c:  add    BYTE PTR [rax],al
   0x000000000800052e:  add    BYTE PTR [rax],al
End of assembler dump.
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>我們再循線下去，我們反組譯 GOT 表格地址 <code>0x8200fd0</code></p> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>gdb-peda$ disassemble 0x8200fd0
Dump of assembler code for function _GLOBAL_OFFSET_TABLE_:
   0x0000000008200fb8:  enter  0x200d,0x0
   0x0000000008200fbc:  add    BYTE PTR [rax],al
   0x0000000008200fbe:  add    BYTE PTR [rax],al
   0x0000000008200fc0:  add    BYTE PTR [rax],al
   0x0000000008200fc2:  add    BYTE PTR [rax],al
   0x0000000008200fc4:  add    BYTE PTR [rax],al
   0x0000000008200fc6:  add    BYTE PTR [rax],al
   0x0000000008200fc8:  add    BYTE PTR [rax],al
   0x0000000008200fca:  add    BYTE PTR [rax],al
   0x0000000008200fcc:  add    BYTE PTR [rax],al
   0x0000000008200fce:  add    BYTE PTR [rax],al
   0x0000000008200fd0:  movabs al,ds:0x7fffff080a
   0x0000000008200fd9:  add    BYTE PTR [rax],al
   0x0000000008200fdb:  add    BYTE PTR [rax],al
   0x0000000008200fdd:  add    BYTE PTR [rax],al
   0x0000000008200fdf:  add    BYTE PTR [rax],dl
   0x0000000008200fe1:  sbb    eax,DWORD PTR [rdx]
   0x0000000008200fe3:  (bad)
   0x0000000008200fe4:  (bad)
   0x0000000008200fe5:  jg     0x8200fe7
   0x0000000008200fe7:  add    BYTE PTR [rax],al
   0x0000000008200fe9:  add    BYTE PTR [rax],al
   0x0000000008200feb:  add    BYTE PTR [rax],al
   0x0000000008200fed:  add    BYTE PTR [rax],al
   0x0000000008200fef:  add    BYTE PTR [rax],al
   0x0000000008200ff1:  add    BYTE PTR [rax],al
   0x0000000008200ff3:  add    BYTE PTR [rax],al
   0x0000000008200ff5:  add    BYTE PTR [rax],al
   0x0000000008200ff7:  add    BYTE PTR [rax+0x36],al
   0x0000000008200ffa:  add    al,0xff
   0x0000000008200ffc:  (bad)
   0x0000000008200ffd:  jg     0x8200fff
   0x0000000008200fff:  add    BYTE PTR [rax],al
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>可以看到 <code>0x0000000008200fd0: movabs al,ds:0x7fffff080a</code>，儲存一個地址，那個就是 put 函數的地址，這裡有幾種方式可以確認是 put 函數地址</p> <ol><li>利用 <code>tele</code> 指令</li></ol> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>gdb-peda$ tele 0x8200fd0
0000| 0x8200fd0 --&gt; 0x7fffff080aa0 (&lt;_IO_puts&gt;: push   r13)
0008| 0x8200fd8 --&gt; 0x0
0016| 0x8200fe0 --&gt; 0x7fffff021b10 (&lt;__libc_start_main&gt;:        push   r13)
0024| 0x8200fe8 --&gt; 0x0
0032| 0x8200ff0 --&gt; 0x0
0040| 0x8200ff8 --&gt; 0x7fffff043640 (&lt;__cxa_finalize&gt;:   push   r15)
0048| 0x8201000 --&gt; 0x0
0056| 0x8201008 (0x0000000008201008)
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>利用 <code>xinfo</code> 指令</li></ol> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-text"><code>gdb-peda$ xinfo 0x8200fd0
0x8200fd0 --&gt; 0x7fffff080aa0 (&lt;_IO_puts&gt;:       push   r13)
Virtual memory mapping:
Start : 0x08200000
End   : 0x08201000
Offset: 0xfd0
Perm  : r--p
Name  : /mnt/c/Users/lovel/Desktop/linker/hello
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="3"><li>利用 <code>print</code> 指令</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>gdb-peda$ print puts
$1 = {int (const char *)} 0x7fffff080aa0 &lt;_IO_puts&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>當然，你也可以直接看 PLT 的項目名稱得知</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>gdb-peda$ x/16x 0x0000000008000510
0x8000510 &lt;puts@plt&gt;:   0x0aba25ff      0x00680020      0xe9000000      0xffffffe0
0x8000520 &lt;__cxa_finalize@plt&gt;: 0x0ad225ff      0x90660020      0x00000000      0x00000000
0x8000530 &lt;_start&gt;:     0x8949ed31      0x89485ed1      0xe48348e2      0x4c5450f0
0x8000540 &lt;_start+16&gt;:  0x018a058d      0x8d480000      0x0001130d      0x3d8d4800
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>還真的是 <code>puts</code> 函數地址，那接下來我們要確認是否為 <code>libc.so</code> 的符號，利用 <code>info symbol</code> 查看</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>gdb-peda$ info symbol puts
puts in section .text of /lib/x86_64-linux-gnu/libc.so.6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我們更加確定，透過 GOT 儲存的 <code>put</code>地址，就直接跳到 <code>libc.so</code> 的程式碼區段去執行 ~</p> <p>咦 !? 為什麼你的 GDB 追蹤，GOT 直接就有地址值了，沒有再跳回去 PLT 重新解析，這裡有個比較奇怪的地方，就是載入時就幫你做好符號解析了，GOT表就存放 <code>puts</code> 的函數地址，不需要再去叫動態鏈接器做事，其實很多參考連結，都可以追蹤到 <code>dl_runtime_resolve</code> 的函數，但我這裡總是沒追到。</p> <p>我認為有可能是比較新的載入器(loader)設計對動態鏈結符號解析有再做一些最佳化，<a href="https://hackmd.io/@rhythm/ry5pxN6NI" target="_blank" rel="noopener noreferrer">Linux/ELF動態鏈接部分機制(GOT&amp;PLT)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 也有遇到相同問題。經過了幾番尋找，這正是下一篇介紹的技術 - <code>prelink</code>。</p> <h3 id="_3-4-aslr-and-prelink-技術"><a href="#_3-4-aslr-and-prelink-技術" class="header-anchor">#</a> 3-4. ASLR and Prelink 技術</h3> <p>在上一個小節，我們用 <code>gdb</code> 來追查動態鏈結的行為，卻發現 GOT 表沒有經過動態鏈結器就存放了 <code>put</code> 的地址， <mark>好像是預先就做好符號解析一樣</mark>，沒錯，回到動態鏈結，你可以發現最原始動態鏈結的方法會帶來一些成本，每次重新啟動時都要重新解析符號地址。解析時又要額外叫動態鏈接器來幫忙。一來一回會浪費很多 CPU cycle 去執行，假設今天要解析一千萬個符號，我相信動態鏈接重定位符號的時間一定佔用不少執行期時間。所以今天在現代作業系統就有更進一步的作法 - <code>預鏈接(prelink)</code>。</p> <p><a href="https://en.wikipedia.org/wiki/Prelink" target="_blank" rel="noopener noreferrer">Prelink wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>定義</li></ol> <blockquote><p>In computing, prebinding, also called prelinking, is a method for optimizing application load times by resolving library symbols prior to launch.</p></blockquote> <p>Prelink 是一個在程式執行前先解析函式庫符號地址的一種最佳化方法。這也可以對應到，我們在 3-1、3-2 小節看到還沒執行時的，GOT[1] 表放的是 PLT 下一個地址，但在執行時就馬上有 put 函數的地址，好像是某個無名英雄默默行善，或是像 JOJO 第五部大魔王迪亞波羅的替身緋紅之王的能力 - 時間刪除。</p> <p><img src="https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2FD7OUe6PTQvqaXHT1GHsEVmwlkQmXvalOQVXnqs5wm3ogT1564321178485.jpeg&amp;thumbnail=650x2147483647&amp;quality=80&amp;type=jpg" alt=""></p> <p>扯遠了🤣，這個無名英雄就是 <code>Prelink</code>，在維基中也有提到</p> <blockquote><p>While dynamic linking has advantages in code size and management, there are drawbacks as well. Every time a program is run, the loader needs to resolve (find) the relevant libraries. Since libraries move around in memory, there is a performance penalty for resolution. This penalty increases for each additional library needing resolution.
Prelinking reduces this penalty by resolving libraries in advance. Afterward, resolution only occurs if the libraries have changed since being prelinked, such as following perhaps an upgrade.</p></blockquote> <p>當事先做鏈接，有個好處就是可以在執行執行得更快，GOT 表格就已經更新好了，不用執行時做解析當然可以跑得更快 ! 而且最後面提到，如果函式庫更新才需要做地址重定位重解析。</p> <p>在<a href="https://www.twblogs.net/a/5c7d7b8ebd9eee114211f91d" target="_blank" rel="noopener noreferrer">使用 Prelink 加速程序啓動<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，一文中，也有介紹</p> <blockquote><p>Prelink 是 Red Hat 開發者 Jakub Jelinek 所設計的工具。正如其名字所示，Prelink 利用事先鏈接代替運行時鏈接的方法來加速共享庫的加載。它不僅可以加快起動速度，還可以減少部分內存開銷，是各種 Linux 架構上用於減少程序載入時間、縮短系統啓動時間和加快應用程序啓動的很受歡迎的一個工具。
<mark>Prelink 工具的原理主要基於這樣一個事實：動態鏈接和加載的過程開銷很大，並且在大多數的系統上，函數庫並不會常常被更動，每次程序被執行時所進行的鏈接動作都是完全相同的</mark> ，對於嵌入式系統來說尤其如此。因此，這一過程可以改在執行前就可以預先處理好，即花一些時間利用 Prelink 工具對動態共享庫和可執行文件進行處理，修改這些二進制文件並加入相應的重定位等信息，<mark>節約了本來在程序啓動時的比較耗時的查詢函數地址等工作，這樣可以減少程序啓動的時，同時也減少了內存的耗用。</mark> <mark>Prelink 的這種做法當然也有代價：每次更新動態共享庫時，相關的可執行文件都需要重新執行一遍 Prelink 才能保證有效，因爲新的共享庫中的符號信息、地址等很可能與原來的已經不同了。這種代價對於嵌入式系統的開發者來說可能稍微帶來一些複雜度，不過好在對用戶來說幾乎是可以忽略的。</mark></p></blockquote> <p>你對 <code>Prelink</code> 可能就一些理解了，簡單來說就是預先處理好引用符號地址到 GOT 表，真正載入後執行就可以直接把 GOT 當快取去執行函數。</p> <p>在程式啓動時，當調用 printf 的時候，程序會將處理權交給 loader，由其負責在行程以及其鏈接的動態庫中查找 printf 的函數地址。由於 loader 不知道 printf 是在哪個動態庫，所以它將在整個行程和動態庫的範圍內查找。更糟糕的是在 C++ 程序中，符號的命名是類名+函數名，這導致在做字符串比較時，往往直到字符串的結尾才能獲得結果。</p> <p>這就導致了，在行程啓動過程中，符號查找往往佔據了大部分時間。據統計，在 Linux 的 KDE 進程中啓動過程中，<mark>符號查找表竟佔據了行程啓動 80% 的時間</mark> 。有沒有辦法來改進呢？如果進程在執行前，就能獲知動態庫的加載地址，那麼函數調用的地址就應該是已知的，我們就可以通過修改執行程序，來避免符號的查找。從而節省行程啓動的時間。</p> <p>另外和 dynamic linker 跟 prelink 有關的技術，是 ASLR(Address Space Layout Randomization)，簡單來說就是每次載入時函式庫的基本地址是隨機的，如下</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>unix$ ldd hello
        linux-vdso.so.1 (0x00007fffe3188000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa6ccff0000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fa6cd800000)

unix$ ldd hello
        linux-vdso.so.1 (0x00007fffd6150000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f6b26ce0000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f6b27400000)

unix$ ldd hello
        linux-vdso.so.1 (0x00007fffe9e6a000)
        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f664d7e0000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f664de00000)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>你也可以利用 <code>strace ./hello</code> 看看用到的 <code>System Call</code></p> <div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>execve(&quot;./hello&quot;, [&quot;./hello&quot;], 0x7ffffea85260 /* 21 vars */) = 0
brk(NULL)                               = 0x7fffe8b5d000
access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)
access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, &quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=46345, ...}) = 0
mmap(NULL, 46345, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f6966ed8000
close(3)                                = 0
access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, &quot;/lib/x86_64-linux-gnu/libc.so.6&quot;, O_RDONLY|O_CLOEXEC) = 3
read(3, &quot;\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0&gt;\0\1\0\0\0\20\35\2\0\0\0\0\0&quot;..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=2030928, ...}) = 0
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6966ed0000
mmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f6966800000
mprotect(0x7f69669e7000, 2097152, PROT_NONE) = 0
mmap(0x7f6966be7000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f6966be7000
mmap(0x7f6966bed000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f6966bed000
close(3)                                = 0
arch_prctl(ARCH_SET_FS, 0x7f6966ed14c0) = 0
mprotect(0x7f6966be7000, 16384, PROT_READ) = 0
mprotect(0x7f6967200000, 4096, PROT_READ) = 0
mprotect(0x7f6966e29000, 4096, PROT_READ) = 0
munmap(0x7f6966ed8000, 46345)           = 0
fstat(1, {st_mode=S_IFCHR|0660, st_rdev=makedev(4, 3), ...}) = 0
ioctl(1, TCGETS, {B38400 opost isig icanon echo ...}) = 0
brk(NULL)                               = 0x7fffe8b5d000
brk(0x7fffe8b7e000)                     = 0x7fffe8b7e000
write(1, &quot;Hello World!\n&quot;, 13Hello World!
)          = 13
exit_group(0)                           = ?
+++ exited with 0 +++
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>最後，如果想知道如何結合 ASLR 和 prelink 機制，可以參考</p> <ul><li><a href="https://cosmoss-vt.github.io/pages/pubs/prelink-yoon-esa14.pdf" target="_blank" rel="noopener noreferrer">Dynamic-prelink: An Enhanced Prelinking Mechanism without Modifying Shared Libraries<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，以後有時間會分享文章。</li></ul> <h3 id="_3-5-靜態鏈結和動態鏈結的比較"><a href="#_3-5-靜態鏈結和動態鏈結的比較" class="header-anchor">#</a> 3-5. 靜態鏈結和動態鏈結的比較</h3> <p>參考至 <a href="https://stackoverflow.com/questions/1993390/static-linking-vs-dynamic-linking" target="_blank" rel="noopener noreferrer">Static linking vs dynamic linking<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，比較動態鏈接跟靜態鏈接的優缺點</p> <ol><li><p>靜態鏈結 (Static link)</p> <ul><li><p>優點</p> <ol><li>啟動速度比動態鏈結稍微快一點(但也取決於技術)</li> <li>因為他將所有需要的東西、函式庫打包，靜態連結後的執行檔案更容易在不同環境順利執行</li> <li>很適合在有限的資源環境下(開機程序、救援模式等)</li></ol></li> <li><p>缺點</p> <ol><li>程式肥胖，耗硬碟、記憶體資源</li> <li>更新函式庫時要重新編譯鏈結打包</li></ol></li></ul></li> <li><p>動態鏈結 (Dynamic link)</p> <ul><li><p>優點</p> <ol><li>動態鏈結程式占用記憶體、硬碟空間較小</li> <li>延遲綁定(lazy binding)機制</li> <li>幾乎無痛更新函式庫，程式也可以順利執行</li></ol></li> <li><p>缺點</p> <ol><li>每次都要重新解析符號地址，動態鏈接器會占用執行期不少的CPU時間，改善的機制為prelink</li> <li>DLL Hell - 更新函式庫發生的問題，導致程式無法順利執行</li></ol></li></ul></li></ol> <h2 id="四、未解之謎"><a href="#四、未解之謎" class="header-anchor">#</a> 四、未解之謎</h2> <ol><li>為何需要 PLT，不直接使用 GOT 就好，GOT 內預設放 resolver 地址，如果還沒解析就去更新這個表項，有的話就直接跳轉 ?</li></ol> <p>參考這篇 <a href="https://stackoverflow.com/questions/43048932/why-does-the-plt-exist-in-addition-to-the-got-instead-of-just-using-the-got" target="_blank" rel="noopener noreferrer">Why does the PLT exist in addition to the GOT, instead of just using the GOT?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol start="2"><li>如何關掉 prelink 的機制，這樣我比較好追蹤 GOT PLT 的機制 🤣</li></ol> <h3 id="🎉-2021-09-26-解開-一切都是-gcc-的鍋-🎉"><a href="#🎉-2021-09-26-解開-一切都是-gcc-的鍋-🎉" class="header-anchor">#</a> 🎉 2021/09/26 解開 - 一切都是 GCC 的鍋 🎉</h3> <p>之後我又回來複習一遍時，深入去找原因，為什麼我的 PLT 總是已經被鏈接好了 ?</p> <p>在看到 <a href="https://ypl.coffee/dl-resolve/" target="_blank" rel="noopener noreferrer">Understanding _dl_runtime_resolve()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 後，我就發現該作者下了 <code>gcc -Wl,-z,lazy -o hello hello.c</code> 當中的 lazy 選項，為什麼要 <mark>顯式指定 lazy</mark>，隨後我使用 <code>ld --help | grep &quot;\-z lazy&quot;</code> 指令查詢，得到下列結果</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> -z lazy                     Mark object lazy runtime binding (default)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>咦 ? 那為何預設是 lazy binding 但是卻預先鏈結好了? 直到我找到了這一篇
<a href="https://stackoverflow.com/questions/62527697/why-does-gcc-link-with-z-now-by-default-although-lazy-binding-is-the-default" target="_blank" rel="noopener noreferrer">Why does gcc link with '-z now' by default, although lazy binding is the default for ld?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>問問題的人問為什麼 ld 預設是 <code>-z lazy</code>，但是 gcc 卻自動送給 linker <code>-z now -z relro</code>  請 linker 馬上鏈結跟重定位</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>gcc --verbose -o hello_link hello.c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-text"><code>COLLECT_GCC_OPTIONS='-v' '-o' 'hello_link' '-mtune=generic' '-march=x86-64'
 /usr/lib/gcc/x86_64-linux-gnu/7/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/7/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper -plugin-opt=-fresolution=/tmp/cceRjjri.res -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr -m elf_x86_64 --hash-style=gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie 
 -z now -z relro -o hello_link /
 usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/7/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/7 -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/7/../../.. /tmp/ccdANW6g.o -lgcc --push-state --as-needed -lgcc_s --pop-state -lc -lgcc --push-state --as-needed -lgcc_s --pop-state /usr/lib/gcc/x86_64-linux-gnu/7/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/crtn.o
COLLECT_GCC_OPTIONS='-v' '-o' 'hello_link' '-mtune=generic' '-march=x86-64'
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我就馬上知道了，因為我之前的編譯方式是 <code>gcc -g -Wall hell.c -o hello</code>，gcc 會自動預設送 <code>-z now -z relro</code>，難怪會這樣 = =，害我都追蹤不到動態鏈結器跟 Lazy-binding 機制。但是其實這麼做是有原因的
<mark>因為 GOT 在 lazy binding 時會變成可寫的記憶體區段，會遭受 GOT hijacking(overwrite) 的攻擊</mark>，如果載入前就鏈結好，就可以把GOT變成唯讀區段，就會比較安全，此種方法叫做 <mark>RELRO: RELocation Read-Only</mark>，是 ubuntu 16.10 引進的名為
<mark>ELF binary hardening feature</mark>，所以如果往後要自行追蹤 GOT 時，用 gcc 編譯時要記得顯式加入 <code>-z lazy</code> 不然就是自行手動鏈結。</p> <p>另外因為這個謎底解開，也發現前面有些錯誤，GOT 表其實前三項是原本就有定義的，但是若先鏈結好，就可以從 GOT[1] 開始放符號位置了，因為不再需要動態鏈結器幫忙解析跟重定位了。</p> <table><thead><tr><th>GOT 項</th> <th>作用</th></tr></thead> <tbody><tr><td>GOT[0]</td> <td>紀錄執行檔的 .dynamic section 的位置，這section紀錄很多動態鏈結器的需要知道的資訊(此執行檔相依的函式庫等)，做初始化的動作</td></tr> <tr><td>GOT[1]</td> <td>放 link_map 的 結構體的 doubly linked list，內有紀錄函式庫路徑跟名稱等資訊，初始值是 0，但是等動態鏈結器初始化後得到所有的相依函式庫的資訊，就會用這種方式串起來，隨後有要解析的符號就會一個一個相依的函式庫下去找</td></tr> <tr><td>GOT[2]</td> <td>一樣初始值是 0，等動態鏈結器初始化完後才有值，這裡放 _dl_runtime_resolve() 的函式地址，把 link_map 傳入就可以開始解析未知的符號並修改 GOT 表</td></tr></tbody></table> <p>GCC 幫我們處理很多事情，若是我們忽略其中的細節，就會不小心踩到坑。😂😂😂</p> <h3 id="參考連結"><a href="#參考連結" class="header-anchor">#</a> 參考連結</h3> <ul><li><a href="https://ypl.coffee/dl-resolve/" target="_blank" rel="noopener noreferrer">Understanding _dl_runtime_resolve()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://hockeyinjune.medium.com/relro-relocation-read-only-c8d0933faef3" target="_blank" rel="noopener noreferrer">RELRO: RELocation Read-Only<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.redhat.com/en/blog/hardening-elf-binaries-using-relocation-read-only-relro" target="_blank" rel="noopener noreferrer">Hardening ELF binaries using Relocation Read-Only (RELRO)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://stackoverflow.com/questions/62527697/why-does-gcc-link-with-z-now-by-default-although-lazy-binding-is-the-default" target="_blank" rel="noopener noreferrer">Why does gcc link with '-z now' by default, although lazy binding is the default for ld?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="五、結論"><a href="#五、結論" class="header-anchor">#</a> 五、結論</h2> <p>這篇文章我承認自己是覺得還需要再整理，因為動態鏈結機制相對較複雜。後期針對動態鏈接的最佳化論文可能還要去分析一下。那以這張很棒的圖做為結尾😀</p> <p><img src="https://mdimg.wxwenku.com/getimg/356ed03bdc643f9448b3f6485edc229bb583d3da773c5e44937ad7333eec08f9ee8d6dada3b5682d117d767bbc5ce1b7.jpg" alt=""></p> <ol><li>PLT 內每個元素都是跳轉指令，先跳去 GOT 看有沒有函數地址，沒有就跳回來再跳去 PLT 第一項去叫動態鏈接器解析地址更新，有的話直接執行就好，甭跳回來。</li> <li>動態鏈結機制有 prelink 方法可以加速執行時間，但 prelink 跟 ASLR 的關係要再去看論文。</li> <li>動態鏈結跟靜態鏈結各有好處跟壞處。但我認為動態鏈結更加彈性、優點更多。</li></ol> <h2 id="六、參考連結"><a href="#六、參考連結" class="header-anchor">#</a> 六、參考連結</h2> <ol><li><p><a href="https://hackmd.io/@rhythm/ry5pxN6NI" target="_blank" rel="noopener noreferrer">Linux/ELF動態鏈接部分機制(GOT&amp;PLT)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.usenix.net/sites/default/files/conference/protected-files/sec15_slides_difederico.pdf" target="_blank" rel="noopener noreferrer">How the ELF ruined
Christmas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.cntofu.com/book/46/linked_and_loader/gothe_plt_yuan_li_jian_xi.md" target="_blank" rel="noopener noreferrer">GOT和PLT原理簡析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://brandon-hy-lin.blogspot.com/2015/12/shared-library-plt-got.html" target="_blank" rel="noopener noreferrer">Shared Library 中 PLT 和 GOT 的使用機制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.gushiciku.cn/pl/p5nO/zh-tw" target="_blank" rel="noopener noreferrer">動態連結的PLT與GOT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://stackoverflow.com/questions/43048932/why-does-the-plt-exist-in-addition-to-the-got-instead-of-just-using-the-got" target="_blank" rel="noopener noreferrer">Why does the PLT exist in addition to the GOT, instead of just using the GOT?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf" target="_blank" rel="noopener noreferrer">gdb cheetsheet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://github.com/kibercthulhu/gdb-peda-cheatsheet/blob/master/gdb-peda%20cheatsheet.pdf" target="_blank" rel="noopener noreferrer">gdb-peda cheetsheet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://github.com/longld/peda" target="_blank" rel="noopener noreferrer">gdb-peda<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://rickgray.me/2015/08/07/use-gdb-to-study-got-and-plt/" target="_blank" rel="noopener noreferrer">通過GDB 調試理解GOT/PLT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://luomuxiaoxiao.com/?p=343" target="_blank" rel="noopener noreferrer">計算機原理系列之六——– 可執行文件詳解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.technovelty.org/linux/plt-and-got-the-key-to-code-sharing-and-dynamic-libraries.html" target="_blank" rel="noopener noreferrer">PLT and GOT - the key to code sharing and dynamic libraries<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://reverseengineering.stackexchange.com/questions/23311/dumping-the-got-with-gdb-at-run-time" target="_blank" rel="noopener noreferrer">Dumping the GOT with gdb at run time<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://en.wikipedia.org/wiki/Prelink" target="_blank" rel="noopener noreferrer">Prelink Wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.twblogs.net/a/5c7d7b8ebd9eee114211f91d" target="_blank" rel="noopener noreferrer">使用 Prelink 加速程序啓動<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://cosmoss-vt.github.io/pages/pubs/prelink-yoon-esa14.pdf" target="_blank" rel="noopener noreferrer">Dynamic-prelink: An Enhanced Prelinking Mechanism without Modifying Shared Libraries<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://csstormq.github.io/blog/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%AF%87%E4%B9%8B%E9%93%BE%E6%8E%A5%EF%BC%8814%EF%BC%89%EF%BC%9A.plt%E3%80%81.plt.got%E3%80%81.got%20%E5%92%8C%20.got.plt%20section%20%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB" target="_blank" rel="noopener noreferrer">計算機系統篇之鍊接（14）：.plt、.plt.got、.got和.got.plt部分之間的區別<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://zhuanlan.zhihu.com/p/375510683" target="_blank" rel="noopener noreferrer">Linux系統中編譯、鏈接的基石-ELF文件：扒開它的層層外衣，從字節碼的粒度來探索<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">Tue Jan 04 2022 20:00:01 GMT+0800</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/coding-hub/blogs/ELF/symbol.html" class="prev">
            Hello World Odyssey - Part 2. 關於符號的大小事
          </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><!----><div class="vuepress-canvas-nest-element"></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/coding-hub/assets/js/app.df64d80b.js" defer></script><script src="/coding-hub/assets/js/6.5a677154.js" defer></script><script src="/coding-hub/assets/js/1.0bfbaed9.js" defer></script><script src="/coding-hub/assets/js/17.f13925a9.js" defer></script><script src="/coding-hub/assets/js/11.c55c4bcd.js" defer></script>
  </body>
</html>

(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{785:function(t,_,r){"use strict";r.r(_);var e=r(5),v=function(t){t.options.__data__block__={chart_382ee148:'{\n  "type": "bar",\n  "data": {\n    "labels": ["interpreter", "interpreter opt1", "interpreter opt3", "interpreter opt2", "sed", "jit opcode", "compiler", "jit dynasm", "jit dynasm opt2", "jit dynasm opt1", "sed O2", "sed O1", "sed O3"],\n    "datasets": [{\n      "label": "Execution time (sec)",\n      "data": [129.15, 61.49, 50.66, 46.82, 18.20, 3.92, 3.85, 3.84, 1.26, 1.25, 1.20, 1.18, 1.17 ],\n      "backgroundColor": [\n        "rgba(255, 99, 132, 0.2)",\n        "rgba(255, 159, 64, 0.2)",\n        "rgba(255, 205, 86, 0.2)",\n        "rgba(75, 192, 192, 0.2)",\n        "rgba(54, 162, 235, 0.2)",\n        "rgba(153, 102, 255, 0.2)",\n        "rgba(201, 203, 207, 0.2)",\n        "rgba(255, 99, 132, 0.2)",\n        "rgba(255, 159, 64, 0.2)",\n        "rgba(255, 205, 86, 0.2)",\n        "rgba(75, 192, 192, 0.2)",\n        "rgba(54, 162, 235, 0.2)",\n        "rgba(153, 102, 255, 0.2)",\n        "rgba(201, 203, 207, 0.2)"\n      ],\n      "borderColor": [\n        "rgb(255, 99, 132)",\n        "rgb(255, 159, 64)",\n        "rgb(255, 205, 86)",\n        "rgb(75, 192, 192)",\n        "rgb(54, 162, 235)",\n        "rgb(153, 102, 255)",\n        "rgb(201, 203, 207)",\n        "rgb(255, 99, 132)",\n        "rgb(255, 159, 64)",\n        "rgb(255, 205, 86)",\n        "rgb(75, 192, 192)",\n        "rgb(54, 162, 235)",\n        "rgb(153, 102, 255)",\n        "rgb(201, 203, 207)"\n      ],\n      "borderWidth": 1\n    }]\n  },\n  "options": {\n    "scales": {\n      "yAxes": [{\n        "ticks": {\n          "beginAtZero": true\n        }\n      }]\n    }\n  }\n}',chart_64a561da:'{\n  "type": "bar",\n  "data": {\n    "labels": ["interpreter", "interpreter opt1", "interpreter opt3", "interpreter opt2", "sed"],\n    "datasets": [{\n      "label": "Execution time (sec)",\n      "data": [129.15, 61.49, 50.66, 46.82, 18.20],\n      "backgroundColor": [\n        "rgba(255, 99, 132, 0.2)",\n        "rgba(255, 159, 64, 0.2)",\n        "rgba(255, 205, 86, 0.2)",\n        "rgba(75, 192, 192, 0.2)",\n        "rgba(54, 162, 235, 0.2)"\n      ],\n      "borderColor": [\n        "rgb(255, 99, 132)",\n        "rgb(255, 159, 64)",\n        "rgb(255, 205, 86)",\n        "rgb(75, 192, 192)",\n        "rgb(54, 162, 235)"\n      ],\n      "borderWidth": 1\n    }]\n  },\n  "options": {\n    "scales": {\n      "yAxes": [{\n        "ticks": {\n          "beginAtZero": true\n        }\n      }]\n    }\n  }\n}',chart_64a55998:'{\n  "type": "bar",\n  "data": {\n    "labels": ["interpreter opt1", "interpreter opt3", "interpreter opt2", "jit_dynasm"],\n    "datasets": [{\n      "label": "Execution time (sec)",\n      "data": [61.49, 50.66, 46.82, 3.84],\n      "backgroundColor": [\n        "rgba(255, 99, 132, 0.2)",\n        "rgba(255, 159, 64, 0.2)",\n        "rgba(255, 205, 86, 0.2)",\n        "rgba(75, 192, 192, 0.2)"\n      ],\n      "borderColor": [\n        "rgb(255, 99, 132)",\n        "rgb(255, 159, 64)",\n        "rgb(255, 205, 86)",\n        "rgb(75, 192, 192)"\n      ],\n      "borderWidth": 1\n    }]\n  },\n  "options": {\n    "scales": {\n      "yAxes": [{\n        "ticks": {\n          "beginAtZero": true\n        }\n      }]\n    }\n  }\n}',chart_64a54ae2:'{\n  "type": "bar",\n  "data": {\n    "labels": ["jit opcode", "compiler", "jit dynasm", "jit dynasm opt2", "jit dynasm opt1", "sed O2", "sed O1", "sed O3"],\n    "datasets": [{\n      "label": "Execution time (sec)",\n      "data": [3.92, 3.85, 3.84, 1.26, 1.25, 1.20, 1.18, 1.17 ],\n      "backgroundColor": [\n        "rgba(255, 99, 132, 0.2)",\n        "rgba(255, 159, 64, 0.2)",\n        "rgba(255, 205, 86, 0.2)",\n        "rgba(75, 192, 192, 0.2)",\n        "rgba(54, 162, 235, 0.2)",\n        "rgba(153, 102, 255, 0.2)",\n        "rgba(201, 203, 207, 0.2)",\n        "rgba(255, 99, 132, 0.2)",\n        "rgba(255, 159, 64, 0.2)",\n        "rgba(255, 205, 86, 0.2)"\n      ],\n      "borderColor": [\n        "rgb(255, 99, 132)",\n        "rgb(255, 159, 64)",\n        "rgb(255, 205, 86)",\n        "rgb(75, 192, 192)",\n        "rgb(54, 162, 235)",\n        "rgb(153, 102, 255)",\n        "rgb(201, 203, 207)",\n        "rgb(255, 99, 132)",\n        "rgb(255, 159, 64)"\n      ],\n      "borderWidth": 1\n    }]\n  },\n  "options": {\n    "scales": {\n      "yAxes": [{\n        "ticks": {\n          "beginAtZero": true\n        }\n      }]\n    }\n  }\n}'}},n=Object(e.a)({},(function(){var t=this,_=t.$createElement,r=t._self._c||_;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"part-5-cross-comparison"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#part-5-cross-comparison"}},[t._v("#")]),t._v(" Part 5. Cross Comparison")]),t._v(" "),r("p",[t._v("çµ‚æ–¼é€²å…¥æˆ‘å€‘çš„æœ€çµ‚ç« ï¼Œä¸€å€‹å¤§äº‚é¬¥çš„æ™‚ä»£ ~")]),t._v(" "),r("p",[t._v("é€²åˆ° Part 5 è³‡æ–™å¤¾ï¼ŒåŸ·è¡Œ")]),t._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")]),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br")])]),r("p",[t._v("å°±å¯ä»¥è‡ªå‹•ç·¨è­¯æ‰€æœ‰çš„ç¨‹å¼åŠè¼¸å‡ºæ¯”è¼ƒè¡¨æ ¼èˆ‡åœ–ç‰‡ï¼Œ\né¦–å…ˆå…ˆä¾†çœ‹è¼¸å‡ºçš„è¡¨æ ¼ä»¥åŠåœ–ç‰‡ï¼Œå¾ˆç¾å§ğŸ˜")]),t._v(" "),r("Chart",{attrs:{id:"chart_382ee148",code:t.$dataBlock.chart_382ee148}}),r("table",[r("thead",[r("tr",[r("th",[t._v("Rank")]),t._v(" "),r("th",[t._v("program")]),t._v(" "),r("th",[t._v("real")]),t._v(" "),r("th",[t._v("user")]),t._v(" "),r("th",[t._v("system")]),t._v(" "),r("th",[t._v("Execution Time")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("0")]),t._v(" "),r("td",[t._v("interpreter")]),t._v(" "),r("td",[t._v("2:18.71")]),t._v(" "),r("td",[t._v("129.01")]),t._v(" "),r("td",[t._v("0.14")]),t._v(" "),r("td",[t._v("129.15")])]),t._v(" "),r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("interpreter_opt1")]),t._v(" "),r("td",[t._v("1:02.82")]),t._v(" "),r("td",[t._v("61.48")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("61.49")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("interpreter_opt3")]),t._v(" "),r("td",[t._v("0:53.23")]),t._v(" "),r("td",[t._v("50.54")]),t._v(" "),r("td",[t._v("0.12")]),t._v(" "),r("td",[t._v("50.66")])]),t._v(" "),r("tr",[r("td",[t._v("3")]),t._v(" "),r("td",[t._v("interpreter_opt2")]),t._v(" "),r("td",[t._v("0:47.69")]),t._v(" "),r("td",[t._v("46.79")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("46.82")])]),t._v(" "),r("tr",[r("td",[t._v("4")]),t._v(" "),r("td",[t._v("sed")]),t._v(" "),r("td",[t._v("0:19.47")]),t._v(" "),r("td",[t._v("18.17")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("18.20")])]),t._v(" "),r("tr",[r("td",[t._v("5")]),t._v(" "),r("td",[t._v("jit_opcode")]),t._v(" "),r("td",[t._v("0:04.35")]),t._v(" "),r("td",[t._v("3.89")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("3.92")])]),t._v(" "),r("tr",[r("td",[t._v("6")]),t._v(" "),r("td",[t._v("compiler")]),t._v(" "),r("td",[t._v("0:04.20")]),t._v(" "),r("td",[t._v("3.85")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("3.85")])]),t._v(" "),r("tr",[r("td",[t._v("7")]),t._v(" "),r("td",[t._v("jit_dynasm")]),t._v(" "),r("td",[t._v("0:04.75")]),t._v(" "),r("td",[t._v("3.81")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("3.84")])]),t._v(" "),r("tr",[r("td",[t._v("8")]),t._v(" "),r("td",[t._v("jit_dynasm_opt2")]),t._v(" "),r("td",[t._v("0:01.37")]),t._v(" "),r("td",[t._v("1.25")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("1.26")])]),t._v(" "),r("tr",[r("td",[t._v("9")]),t._v(" "),r("td",[t._v("jit_dynasm_opt1")]),t._v(" "),r("td",[t._v("0:01.46")]),t._v(" "),r("td",[t._v("1.25")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("1.25")])]),t._v(" "),r("tr",[r("td",[t._v("10")]),t._v(" "),r("td",[t._v("sed_O2")]),t._v(" "),r("td",[t._v("0:01.21")]),t._v(" "),r("td",[t._v("1.20")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("1.20")])]),t._v(" "),r("tr",[r("td",[t._v("11")]),t._v(" "),r("td",[t._v("sed_O1")]),t._v(" "),r("td",[t._v("0:01.20")]),t._v(" "),r("td",[t._v("1.17")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("1.18")])]),t._v(" "),r("tr",[r("td",[t._v("12")]),t._v(" "),r("td",[t._v("sed_O3")]),t._v(" "),r("td",[t._v("0:01.18")]),t._v(" "),r("td",[t._v("1.17")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("1.17")])])])]),t._v(" "),r("p",[t._v("å¯ä»¥ç™¼ç¾æˆ‘å€‘å¾é ­åˆ°å°¾çš„å¿ƒè·¯æ­·ç¨‹ï¼Œå¾æœ€ç°¡å–®çš„ interpreter ä¸€è·¯èµ°åˆ° JIT compilerï¼Œæœ€å¾Œæˆ‘å€‘ç¶“éæœ€ä½³åŒ–çš„JIT compiler å’Œ ç·¨è­¯å™¨æ–¹æ³•æœ€ä½³åŒ–çš„é€Ÿåº¦å¹¾ä¹ä¸€è‡´ï¼ŒåŠæ™‚ç·¨è­¯å™¨çš„æ•ˆæœå¾ˆçŒ›å§ğŸ˜ï¼Œæ¥ä¸‹ä¾†ä¸‰å€‹å°ç¯€å°±ä¾†æ¢è¨å„å€‹ä¸åŒæ¯”è¼ƒçš„çµ„åˆã€‚")]),t._v(" "),r("h2",{attrs:{id:"_5-1-interpreter-å®¶æ—"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-interpreter-å®¶æ—"}},[t._v("#")]),t._v(" 5.1 Interpreter å®¶æ—")]),t._v(" "),r("Chart",{attrs:{id:"chart_64a561da",code:t.$dataBlock.chart_64a561da}}),r("table",[r("thead",[r("tr",[r("th",[t._v("Rank")]),t._v(" "),r("th",[t._v("program")]),t._v(" "),r("th",[t._v("real")]),t._v(" "),r("th",[t._v("user")]),t._v(" "),r("th",[t._v("system")]),t._v(" "),r("th",[t._v("Execution Time")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("0")]),t._v(" "),r("td",[t._v("interpreter")]),t._v(" "),r("td",[t._v("2:18.71")]),t._v(" "),r("td",[t._v("129.01")]),t._v(" "),r("td",[t._v("0.14")]),t._v(" "),r("td",[t._v("129.15")])]),t._v(" "),r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("interpreter_opt1")]),t._v(" "),r("td",[t._v("1:02.82")]),t._v(" "),r("td",[t._v("61.48")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("61.49")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("interpreter_opt3")]),t._v(" "),r("td",[t._v("0:53.23")]),t._v(" "),r("td",[t._v("50.54")]),t._v(" "),r("td",[t._v("0.12")]),t._v(" "),r("td",[t._v("50.66")])]),t._v(" "),r("tr",[r("td",[t._v("3")]),t._v(" "),r("td",[t._v("interpreter_opt2")]),t._v(" "),r("td",[t._v("0:47.69")]),t._v(" "),r("td",[t._v("46.79")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("46.82")])]),t._v(" "),r("tr",[r("td",[t._v("4")]),t._v(" "),r("td",[t._v("sed")]),t._v(" "),r("td",[t._v("0:19.47")]),t._v(" "),r("td",[t._v("18.17")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("18.20")])])])]),t._v(" "),r("p",[t._v("å¯ä»¥ç™¼ç¾ï¼Œinterpreter å…ˆç¶“ç”± jumptable çš„å„ªåŒ–å¾Œï¼Œ "),r("mark",[t._v("æ•ˆç‡ç›´æ¥æå‡ä¸€å€")]),t._v(" ï¼Œä¹‹å¾Œå†åŠ ä¸Š"),r("code",[t._v("contineous_count")]),t._v(" çš„é‹ç®—å£“ç¸®å¾Œï¼Œåˆå¿«äº†å¤§ç´„ 15 ç§’ï¼Œè€Œå†åŠ å…¥è™•ç† loop pattern å¾Œï¼Œæ•ˆç‡åè€Œæ…¢äº†ä¸€é»é»ã€‚ä½†æ˜¯é€™äº›éƒ½é‚„æ²’æœ‰ sed å…ˆè½‰æˆ C code å†ç·¨è­¯çš„æ–¹æ³•å¿«ï¼Œ"),r("mark",[t._v("åŸå› æ˜¯å› ç‚º interpreter å„˜ç®¡æœ€ä½³åŒ–ï¼Œä»éœ€è¦è®€å– BF code å¤–ï¼Œæ¯å€‹é‹ç®—éƒ½è¦ç¶“éè‡³å°‘å…©å€‹ branch çš„æŒ‡ä»¤(for loop + switch case)ï¼Œè€Œç·¨è­¯å¾Œçš„ sed å°‘äº†å¾ˆå¤š branch æŒ‡ä»¤ï¼Œè‡ªç„¶è€Œç„¶æŒ‡ä»¤æ•¸é‡å°‘ï¼ŒåŸ·è¡Œæ•ˆç‡ä¹ŸæœƒåŠ å¿«å¾ˆå¤š")]),t._v("ï¼Œé€™å°±æ˜¯ç‚ºä»€éº¼ interpreter ä»ç„¶æ•ˆç‡è¼¸ sed çš„æ–¹æ³•çš„ç†ç”±ã€‚")]),t._v(" "),r("h2",{attrs:{id:"_5-2-æœ€ä½³åŒ–-interpreter-vs-simple-dynasm-jit"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-æœ€ä½³åŒ–-interpreter-vs-simple-dynasm-jit"}},[t._v("#")]),t._v(" 5.2 æœ€ä½³åŒ– Interpreter vs  Simple Dynasm JIT")]),t._v(" "),r("Chart",{attrs:{id:"chart_64a55998",code:t.$dataBlock.chart_64a55998}}),r("table",[r("thead",[r("tr",[r("th",[t._v("Rank")]),t._v(" "),r("th",[t._v("program")]),t._v(" "),r("th",[t._v("real")]),t._v(" "),r("th",[t._v("user")]),t._v(" "),r("th",[t._v("system")]),t._v(" "),r("th",[t._v("Execution Time")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("0")]),t._v(" "),r("td",[t._v("interpreter_opt1")]),t._v(" "),r("td",[t._v("1:02.82")]),t._v(" "),r("td",[t._v("61.48")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("61.49")])]),t._v(" "),r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("interpreter_opt3")]),t._v(" "),r("td",[t._v("0:53.23")]),t._v(" "),r("td",[t._v("50.54")]),t._v(" "),r("td",[t._v("0.12")]),t._v(" "),r("td",[t._v("50.66")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("interpreter_opt2")]),t._v(" "),r("td",[t._v("0:47.69")]),t._v(" "),r("td",[t._v("46.79")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("46.82")])]),t._v(" "),r("tr",[r("td",[t._v("3")]),t._v(" "),r("td",[t._v("jit_dynasm")]),t._v(" "),r("td",[t._v("0:04.75")]),t._v(" "),r("td",[t._v("3.81")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("3.84")])])])]),t._v(" "),r("p",[t._v("å°‡ interpreter å¼•å…¥äº† JIT çš„æŠ€è¡“ï¼Œåœ¨åŸ·è¡Œæ™‚é–“ç”¢ç”Ÿæ©Ÿå™¨ç¢¼ç›´æ¥åŸ·è¡Œï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç„¡è«–æˆ‘å€‘çš„ç›´è­¯å™¨åšäº†å¤šå°‘æœ€ä½³åŒ–ï¼ŒçœŸçš„å°±æ˜¯è¢« JIT å±Œæ‰“ğŸ˜‚ã€‚æ•ˆç‡ç›´æ¥é«˜äº†è¿‘ 15 å€ã€‚æ‰€ä»¥ JIT compiler çš„ç¢ºå¯ä»¥å¹«æˆ‘å€‘å¤§å¹…åŠ é€Ÿç›´è­¯å™¨çš„åŸ·è¡Œæ•ˆç‡ğŸ˜€ã€‚")]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"title"}),r("p",[t._v("ä½ å¯èƒ½æœƒè¦ºå¾—å¾ˆå¥‡æ€ªï¼Œç‚ºä½•åŒæ¨£æ˜¯ç›´è­¯çš„æ„Ÿè¦ºï¼Œä¸æ˜¯éƒ½æ˜¯ for loop å¾Œå† switch åŸ·è¡Œå°æ‡‰çš„ç¨‹å¼ç¢¼å— ?")]),t._v(" "),r("p",[t._v("é€™è£¡æˆ‘ä¹Ÿæƒ³äº†å¾ˆä¹…ï¼Œç‚ºä½•éƒ½æ˜¯æŒ‡ä»¤ï¼Œp++ è·Ÿ ç›´æ¥åŸ·è¡Œæ©Ÿå™¨ç¢¼çš„åŠ æ³•åŸ·è¡Œçš„å°±å·®é€™éº¼å¤š ? ç›¸ä¿¡å¾ˆå¤šäººéƒ½æœƒèª¤ä»¥ç‚ºå°±æ˜¯ç¶²è·¯ä¸Šæ‰€èªªçš„ã€Œç›´æ¥åŸ·è¡Œæ©Ÿå™¨ç¢¼ä¸ç”¨å†é‡æ–°ç¿»è­¯æ‰€ä»¥æ¯”è¼ƒå¿«ã€ï¼Œé€™å¥è©±æ˜¯æ­£ç¢ºçš„ï¼Œå› ç‚ºé€šå¸¸ JIT çš„å¯¦ä½œå°±æ˜¯å¿«å–å¸¸ç”¨çš„æ©Ÿå™¨ç¢¼ï¼Œä½†åœ¨æœ¬ç¯‡çš„å¯¦ä½œä¸­ï¼Œå¦‚åŒæ–‡ç«  "),r("a",{attrs:{href:"https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-2-an-x64-jit/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Adventures in JIT compilation: Part 2 - an x64 JIT"),r("OutboundLink")],1),t._v(" æ‰€è¿°")]),t._v(" "),r("blockquote",[r("p",[t._v("The reason is that the baseline performance of the JIT is vastly better. I've mentioned this briefly in part 1 - imagine what's needed to interpret a single instruction in the fastest interpreter.")]),t._v(" "),r("ol",[r("li",[t._v("Advance pc and compare it to program size.")]),t._v(" "),r("li",[t._v("Grab the instruction at pc.")]),t._v(" "),r("li",[t._v("Switch on the value of the instruction to the right case.")]),t._v(" "),r("li",[t._v("Execute the case.")])]),t._v(" "),r("p",[t._v("This requires a whole sequence of machine instructions, with at least two branches (one for the loop, one for the switch). On the other hand, the JIT just emits a single instruction - no branches. I would say that - depending on what the compiler did while compiling the interpreter - the JIT is between 4 and 8 times faster at running any given BF operation. It has to run many more BF operations because it doesn't optimize, but this difference is insufficient to close the huge baseline gap. Later in this post we're going to see an optimized JIT which performs even better.")])]),t._v(" "),r("p",[t._v("äº‹å¯¦ä¸Šï¼Œ "),r("mark",[t._v("æˆ‘å€‘çš„å¯¦ä½œæ–¹æ³•æ˜¯å…ˆç”¨ for loop æƒä¸€éï¼Œå°‡æ©Ÿå™¨ç¢¼å­˜åœ¨é™£åˆ—è£¡ï¼Œå†ç”¨å¯åŸ·è¡Œçš„è¨˜æ†¶å€æ®µå»åŸ·è¡Œé€™æ®µé™£åˆ—")]),t._v(" ï¼Œè€Œä¸€èˆ¬ç›´è­¯å™¨æ˜¯æ¯åŸ·è¡Œä¸€å€‹æŒ‡ä»¤éƒ½è¦ç¶“éå…©å€‹ branch (for loop + switch)ï¼Œæ‰èƒ½çœŸæ­£åŸ·è¡Œåˆ°é‹ç®—ã€‚å› æ­¤å‡è¨­ BF çš„ code æ˜¯ "),r("code",[t._v("+++")])]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("BF Interpreter")]),t._v(" "),r("th",[t._v("Our BF JIT Compiler")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("jmp branch(loop)"),r("br"),t._v("jmp branch(switch)"),r("br"),t._v("add"),r("br"),t._v("jmp branch(loop)"),r("br"),t._v("jmp branch(switch)"),r("br"),t._v("add"),r("br"),t._v("jmp branch(loop)"),r("br"),t._v("jmp branch(switch)"),r("br"),t._v("add"),r("br")]),t._v(" "),r("td",[t._v("add"),r("br"),t._v("add"),r("br"),t._v("add"),r("br")])])])]),t._v(" "),r("p",[r("mark",[t._v("æ‰€ä»¥ç›¸ç•¶æ–¼ JIT å…ˆå¹«æˆ‘å€‘å¿«é€Ÿæƒäº†ä¸€éè·Ÿåˆ¤æ–·ï¼ŒæŠŠæŒ‡ä»¤å­˜åœ¨ä¸€å€‹é™£åˆ—ï¼Œå†åŸ·è¡Œä¸€æ®µæ²’æœ‰ branch çš„ç¨‹å¼ç¢¼")]),t._v(" ï¼Œ é‚£å¦‚åŒä¸Šè¡¨ï¼Œåœ¨æŒ‡ä»¤åŸ·è¡Œçš„æ•¸é‡ä¸Šå°±å·®å¾ˆå¤šã€‚ä¸€èˆ¬ç›´è­¯å™¨å¯èƒ½å› ç‚ºé‚Šè®€é‚ŠåŸ·è¡Œï¼Œæ‰€ä»¥æ¯åªè¡Œä¸€å€‹å‹•ä½œéƒ½è¦å¤šåšå¹¾å€‹branchæŒ‡ä»¤ï¼Œä¸€æ—¦ç¨‹å¼ç¢¼è¶Šå¤§ï¼Œæ•ˆèƒ½æ•´å€‹å°±æœƒè¢«æ‹–è·¨ï¼Œè€Œåœ¨æˆ‘å€‘ JIT å°±æ˜¯å…ˆä¸€æ¬¡éå¸¸å¿«åˆ¤æ–·æƒä¸€éï¼Œå»é™¤æ‰€æœ‰ branch çš„åˆ¤æ–·ï¼Œç›´æ¥åŸ·è¡Œç´”ç²¹çš„åŠ æ¸›æ³•æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯åœ¨é€™è£¡ JIT å¯ä»¥è´åšä¸€å †å‰è™•ç†ã€æœ€ä½³åŒ–çš„ç›´è­¯å™¨çš„åŸå› ã€‚\n(å‚™è¨» : Dynasm å¹«æˆ‘å€‘æŠŠæŒ‡ä»¤å­˜èµ·ä¾†å†æ”¾å…¥å¯åŸ·è¡Œè¨˜æ†¶é«”å€æ®µåŸ·è¡Œï¼Œé€™ç¯‡"),r("a",{attrs:{href:"https://blog.reverberate.org/2012/12/hello-jit-world-joy-of-simple-jits.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ–‡ç« "),r("OutboundLink")],1),t._v(" å°æ–¼ Dynasm è¬›çš„è »è©³ç´°çš„ )")])]),r("p",[t._v("::: info\né€™ç¨®ç›´è­¯çš„ for loop æ­é… switch case çš„ overhead æœ‰å€‹å°ˆæœ‰åè©å«åš "),r("mark",[t._v("dispatch loop æˆ– dynamic dispatch")]),t._v("ï¼Œå¦‚æœåƒæ˜¯ BF é€™ç¨®æ¯”è¼ƒç°¡å–®çš„ç›´è­¯ï¼Œé‚£ dispatch çš„æˆæœ¬ä½”åŸ·è¡Œæ™‚é–“çš„æ¯”ä¾‹å°±æœƒè¼ƒå¤§ï¼Œè€Œå‚³çµ±æœƒä½¿ç”¨ threaded code æ‰‹æ³•åŠ é€Ÿï¼Œé€™ç¨®åŠ é€Ÿæ‰‹æ³•æœƒæ›´æ˜é¡¯ã€‚é€™å€‹æ–¹æ³•ä¹‹å¾ŒæœƒåŠ å…¥åˆ†æã€‚ä¹Ÿæœ‰åšæ³•æ˜¯å°‡å…¨éƒ¨ç¨‹å¼ç¢¼éƒ½ä¸€æ¬¡å±•é–‹ï¼Œå¦‚åŒæœ¬æ¬¡ JIT ä¸€æ¨£ï¼Œç”¨ç©ºé–“æ›æ™‚é–“çš„æ–¹æ³•ï¼Œå†ç”¨ threaded code é€²è¡Œæœ€ä½³åŒ–ã€‚\n:::")]),t._v(" "),r("h2",{attrs:{id:"_5-3-ç«™åœ¨é¡›å³°-æœ€å¿«çš„è¾£äº›äºº"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-ç«™åœ¨é¡›å³°-æœ€å¿«çš„è¾£äº›äºº"}},[t._v("#")]),t._v(" 5.3 ç«™åœ¨é¡›å³° - æœ€å¿«çš„è¾£äº›äºº")]),t._v(" "),r("Chart",{attrs:{id:"chart_64a54ae2",code:t.$dataBlock.chart_64a54ae2}}),r("table",[r("thead",[r("tr",[r("th",[t._v("Rank")]),t._v(" "),r("th",[t._v("program")]),t._v(" "),r("th",[t._v("real")]),t._v(" "),r("th",[t._v("user")]),t._v(" "),r("th",[t._v("system")]),t._v(" "),r("th",[t._v("Execution Time")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("0")]),t._v(" "),r("td",[t._v("jit_opcode")]),t._v(" "),r("td",[t._v("0:04.35")]),t._v(" "),r("td",[t._v("3.89")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("3.92")])]),t._v(" "),r("tr",[r("td",[t._v("1")]),t._v(" "),r("td",[t._v("compiler")]),t._v(" "),r("td",[t._v("0:04.20")]),t._v(" "),r("td",[t._v("3.85")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("3.85")])]),t._v(" "),r("tr",[r("td",[t._v("2")]),t._v(" "),r("td",[t._v("jit_dynasm")]),t._v(" "),r("td",[t._v("0:04.75")]),t._v(" "),r("td",[t._v("3.81")]),t._v(" "),r("td",[t._v("0.03")]),t._v(" "),r("td",[t._v("3.84")])]),t._v(" "),r("tr",[r("td",[t._v("3")]),t._v(" "),r("td",[t._v("jit_dynasm_opt2")]),t._v(" "),r("td",[t._v("0:01.37")]),t._v(" "),r("td",[t._v("1.25")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("1.26")])]),t._v(" "),r("tr",[r("td",[t._v("4")]),t._v(" "),r("td",[t._v("jit_dynasm_opt1")]),t._v(" "),r("td",[t._v("0:01.46")]),t._v(" "),r("td",[t._v("1.25")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("1.25")])]),t._v(" "),r("tr",[r("td",[t._v("5")]),t._v(" "),r("td",[t._v("sed_O2")]),t._v(" "),r("td",[t._v("0:01.21")]),t._v(" "),r("td",[t._v("1.20")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("1.20")])]),t._v(" "),r("tr",[r("td",[t._v("6")]),t._v(" "),r("td",[t._v("sed_O1")]),t._v(" "),r("td",[t._v("0:01.20")]),t._v(" "),r("td",[t._v("1.17")]),t._v(" "),r("td",[t._v("0.01")]),t._v(" "),r("td",[t._v("1.18")])]),t._v(" "),r("tr",[r("td",[t._v("7")]),t._v(" "),r("td",[t._v("sed_O3")]),t._v(" "),r("td",[t._v("0:01.18")]),t._v(" "),r("td",[t._v("1.17")]),t._v(" "),r("td",[t._v("0.00")]),t._v(" "),r("td",[t._v("1.17")])])])]),t._v(" "),r("p",[t._v("åœ¨é‚„æ²’åšä»»ä½•æœ€ä½³åŒ–å‰(contineous_count, loop pattern)ï¼Œæˆ‘å€‘å¯¦åšçš„æ–¹æ³•æœ€å¤šåªèƒ½åˆ°4ç§’å·¦å³ï¼Œä½†æ˜¯åŠ å…¥äº† Part4 æåˆ°çš„æœ€ä½³åŒ–æŠ€è¡“å¾Œï¼Œæ•´é«”åˆå¿«äº†3ç§’ã€‚åŸ·è¡Œæ•ˆç‡1ç§’å¤šã€‚ä½¿å¾—æˆ‘å€‘å¯¦åšçš„ just in time compiler é€¼è¿‘ clang ç·¨è­¯å™¨é€²è¡Œç¨‹å¼ç¢¼æœ€ä½³åŒ–å¾Œçš„æ•ˆç‡ã€‚å¾ˆå²å®³å§!ğŸ˜‰")]),t._v(" "),r("h2",{attrs:{id:"_5-4-çµå°¾å’Œæœªä¾†å·¥ä½œ"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-çµå°¾å’Œæœªä¾†å·¥ä½œ"}},[t._v("#")]),t._v(" 5.4 çµå°¾å’Œæœªä¾†å·¥ä½œ")]),t._v(" "),r("p",[t._v("æˆ‘å€‘å¯¦ä½œäº†ä¸åŒçš„æ–¹æ³•å»åŸ·è¡Œé‹ç®—é‡å¤§çš„ç¢å½¢ brainfuck ç¨‹å¼æª”ï¼Œæœ€å¾Œåˆ©ç”¨åŠæ™‚ç·¨è­¯æŠ€è¡“åŠ ä¸Šä¸€äº›æœ€ä½³åŒ–æ–¹æ³•ï¼ŒæŠŠ "),r("mark",[t._v("æ™®é€šçš„ interpreter æ•ˆç‡æå‡ 120 å€")]),t._v("ï¼ŒåŸ·è¡Œåªéœ€è¦ 1 ç§’ï¼Œå¯ä»¥èªªæ˜¯éå¸¸å€¼å¾—ä½¿ç”¨åŠæ·±å…¥æ¢è¨çš„æŠ€è¡“ã€‚è‡³æ–¼æœªä¾†å·¥ä½œæ˜¯åŠ å…¥ LLVM åŠ asmjit é€™å…©å€‹å·¥å…·å¹«æˆ‘å€‘å»ºç«‹ JIT ç·¨è­¯å™¨ï¼Œä¸¦ä¸”åŠ å…¥æ¯”è¼ƒï¼Œä¸”æŠŠçµ„åˆèªè¨€çš„åŸºç¤æ‰“ç©©ã€‚")]),t._v(" "),r("h2",{attrs:{id:"_5-5-åƒè€ƒé€£çµ-ç‰¹åˆ¥æ„Ÿè¬çš„ç¶²ç«™"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-åƒè€ƒé€£çµ-ç‰¹åˆ¥æ„Ÿè¬çš„ç¶²ç«™"}},[t._v("#")]),t._v(" 5.5 åƒè€ƒé€£çµ (ç‰¹åˆ¥æ„Ÿè¬çš„ç¶²ç«™)")]),t._v(" "),r("ol",[r("li",[r("p",[r("a",{attrs:{href:"https://nickdesaulniers.github.io/blog/2015/05/25/interpreter-compiler-jit/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Interpreter, Compiler, JIT"),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[r("a",{attrs:{href:"http://accu.cc/content/jit_tour/brainfuck_jit/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JIT ç·¨è­¯å™¨åŸç†ç°¡è¿°/å¯¦ç¾Brainfuck JIT ç·¨è­¯å™¨"),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://hackmd.io/@nKngvyhpQdGagg1V6GKLwA/HJjoxbvke?type=view#2016q3-Homework5---JIT-compiler",target:"_blank",rel:"noopener noreferrer"}},[t._v("2016q3 Homework5 - JIT compiler"),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://hackmd.io/@sysprog/SkBsZoReb?type=view",target:"_blank",rel:"noopener noreferrer"}},[t._v("è™›æ“¬æ©Ÿå™¨è¨­è¨ˆèˆ‡å¯¦ä½œ"),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-1-an-interpreter/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Adventures in JIT compilation: Part 1 - an interpreter"),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://eli.thegreenplace.net/2017/adventures-in-jit-compilation-part-2-an-x64-jit/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Adventures in JIT compilation: Part 2 - an x64 JIT"),r("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);"function"==typeof v&&v(n);_.default=n.exports}}]);
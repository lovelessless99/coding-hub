(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{787:function(s,a,n){"use strict";n.r(a);var e=n(5),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("img",{attrs:{src:"https://luomuxiaoxiao.com/images/got_plt.gif",alt:""}})]),s._v(" "),n("h2",{attrs:{id:"一、動態鏈接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、動態鏈接"}},[s._v("#")]),s._v(" 一、動態鏈接")]),s._v(" "),n("p",[s._v("在前面幾篇，我們講的鏈接都是屬於靜態鏈接(static linking)，鏈接(linking)是指讓一隻程式在呼叫函數或使用外部變數時知道要往哪裡找。但是在實際應用中，動態鏈接(dynamic linking) 較常被使用，一個例子就是C語言<stdio.h>中的 printf()，如果系統中所有要對終端輸出字串的程式都把printf的程式碼包含進原始碼再編譯，不僅會浪費磁碟空間（儲存了一大堆printf），程式同時執行時主記憶體也就被很多個 printf 函數所佔用。換句話說，如果鏈接器以靜態鏈接的方式，"),n("mark",[s._v("在記憶體內就會存在很多 printf 的拷貝，那為何不乾脆用一份重複使用就好呢 ?")])]),s._v(" "),n("p",[s._v("靜態鏈結，鏈結後的可執行文件存在大量拷貝程式碼，浪費硬碟空間，執行時浪費記憶體")]),s._v(" "),n("Mermaid",{attrs:{id:"mermaid-382ee147","data-code":"graph%20TD%0A%20%20%20%20subgraph%20pa%5Bs1.o%5D%0A%20%20%20%20%20%20%20%20p1(s1.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s1(printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pb%5Bs2.o%5D%0A%20%20%20%20%20%20%20%20p2(s2.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s2(printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pc%5Bs3.o%5D%0A%20%20%20%20%20%20%20%20p3(s3.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s3(printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20final%5Bprogram%5D%0A%20%20%20%20%20%20%20%20pp(s1.o%2C%20s2.o%2C%20s3.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s4(s1.o%20printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s5(s2.o%20printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20s6(s3.o%20printf%20%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20end%0A%0A%20%20%20%20p1%20--%3E%20pp%0A%20%20%20%20p2%20--%3E%20pp%0A%20%20%20%20p3%20--%3E%20pp%0A%0A%20%20%20%20s1%20--%3E%20s4%0A%20%20%20%20s2%20--%3E%20s5%0A%20%20%20%20s3%20--%3E%20s6%0A"}}),n("p",[s._v("當使用動態鏈結技術時，當使用到 "),n("code",[s._v("printf")]),s._v(" 時，才去做動態鏈結到該程式碼區段，去 libc.so 的 printf 的程式碼執行後返回。動態鏈接可以使得多個程式共用函數，進而得到節省記憶體的效果。另外，在程式執行期才做函數地址解析的方法，稱為動態鏈接，也稱為延遲綁定(Lazy binding)。")]),s._v(" "),n("Mermaid",{attrs:{id:"mermaid-382ee14b","data-code":"graph%20TD%0A%20%20%20%20subgraph%20pa%5Bs1.o%5D%0A%20%20%20%20%20%20%20%20p1(s1.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC%20%2B%20%E5%BC%95%E7%94%A8%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pb%5Bs2.o%5D%0A%20%20%20%20%20%20%20%20p2(s2.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC%20%2B%20%E5%BC%95%E7%94%A8%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20pc%5Bs3.o%5D%0A%20%20%20%20%20%20%20%20p3(s3.o%20%E7%A8%8B%E5%BC%8F%E7%A2%BC%20%2B%20%E5%BC%95%E7%94%A8%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20final%5Bprogram%5D%0A%20%20%20%20%20%20%20%20pp(s1.o%2C%20s2.o%2C%20s3.o%20%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BC%8F%E7%A2%BC)%0A%20%20%20%20%20%20%20%20need(%E5%BC%95%E7%94%A8%E5%88%B0%20printf)%0A%20%20%20%20end%0A%0A%20%20%20%20subgraph%20lib.so%0A%20%20%20%20%20%20%20%20printf%0A%20%20%20%20end%20%0A%0A%20%20%20%20need%20--%3E%20printf%20%0A%20%20%20%20p1%20--%3E%20pp%0A%20%20%20%20p2%20--%3E%20pp%0A%20%20%20%20p3%20--%3E%20pp%0A"}}),n("p",[s._v("所以說比較有效率的方式是讓系統的主記憶體只存著一份printf函數，其他所有程式要輸出字串時讓CPU跳到唯一存放printf的地方執行，結束再跳回原來的程式就行了。"),n("mark",[s._v("之所以叫做動態，就是因為程式編譯時，並不會知道所呼叫的函數在哪裡，無法在編譯時「鏈接」，只能在程式從硬碟載入記憶體時動態地在系統的幫助下完成鏈接。")])]),s._v(" "),n("p",[s._v("為了保證程式碼重複使用和節省系統資源，在鏈接時，動態鏈接庫的 .rodata section 和 .data section 等是不會被複製到最終生成的可執行檔案中，這些部分會在程序載入的時候複製到記憶體，並做動態鏈接，使原來可執行文件能夠對其中定義的符號正常引用。也就是說在這個時候，可執行檔案的程式碼區段(.text section)中對動態鏈接函式庫包含的符號引用的地址才真正確定下來。另外對動態鏈接還有一個好處，就是在更新函式庫的時候更方便，因為是在執行時才會解析函數地址，所以基本上不用像靜態鏈結一樣重新編譯，直接替換即可。")]),s._v(" "),n("p",[s._v("另外一個容易搞混的名詞是動態載入 ( Dynamic Loading )，動態鏈結是把需要的函式庫在載入時就放進記憶體。那動態載入是利用 "),n("code",[s._v("dlopen")]),s._v(" 在執行期間動態載入函式庫到記憶體，兩者的差別是在載入函式庫的時機點。")]),s._v(" "),n("p",[s._v("總結動態鏈接相對於靜態鏈接的優點")]),s._v(" "),n("ul",[n("li",[s._v("更新函式庫更方便，不用重新編譯")]),s._v(" "),n("li",[s._v("省硬碟、記憶體空間")])]),s._v(" "),n("h2",{attrs:{id:"二、兩大主角-got-和-plt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、兩大主角-got-和-plt"}},[s._v("#")]),s._v(" 二、兩大主角 - GOT 和 PLT")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("GOT (Global Offset Table)")]),s._v(" "),n("p",[s._v("GOT存著很多個一樣大小的元素，形成一個table(基本上就是array)。每個元素都是一個指標(所以說32位元機器一個元素4個bytes，64位元就是8個bytes)，指向程式所需要的變數或者是函數，也有可能是系統需要的指標。"),n("mark",[s._v("簡單來說，就是一個存指向函數、變數指標的一維陣列。")])])]),s._v(" "),n("li",[n("p",[s._v("PLT (Procedure Linkage Table)")]),s._v(" "),n("p",[s._v("PLT存著很多個一樣大小的元素，形成一個table(基本上就是array)。 "),n("mark",[s._v("每個元素都是一小段程式碼")]),s._v(" ，第一個元素是公共plt，負責呼叫動態鏈接器。從第二個開始每個元素分別對應到一個動態鏈接的函數，會使用該函數所對應之GOT元素。")])])]),s._v(" "),n("p",[s._v("以上兩個主角的內容，之後會用 "),n("code",[s._v("Debugger")]),s._v(" 搭配 "),n("code",[s._v("readelf")]),s._v(" 展示給大家看。")]),s._v(" "),n("p",[s._v("printf 的動態鏈接流程如下")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://img.cntofu.com/book/note/linked_and_loader/images/plt_after.png",alt:""}})]),s._v(" "),n("Mermaid",{attrs:{id:"mermaid-382ee200","data-code":"graph%20LR%0A%20%20%20%20printf%5B%22call%20printf%22%5D%20--%3E%20PLT%20--%3E%7C%E5%8E%BB%E6%9F%A5%20GOT%20%E5%B0%8D%E6%87%89%E7%B4%A2%E5%BC%95%E7%9A%84%E9%A0%85%E7%9B%AE%7C%20GOT%0A%20%20%20%20GOT%20--%3E%20add%7B%E8%A9%B2%E9%A0%85%E6%9C%89%E5%87%BD%E6%95%B8%E5%9C%B0%E5%9D%80%3F%7D%20--%3E%7CYes%7C%20Success(%E8%B7%B3%E5%88%B0%E8%A9%B2%E5%87%BD%E6%95%B8%E5%9C%B0%E5%9D%80%E5%9F%B7%E8%A1%8C)%0A%20%20%20%20add%20--%3E%20%7CNo%7C%20fail%5B_dl_runtime_resolve%5D%20--%3E%20update%5B%E6%9B%B4%E6%96%B0%20GOT%20table%20%E5%B0%8D%E6%87%89%E7%B4%A2%E5%BC%95%E8%A9%B2%E5%89%9B%E5%89%9B%E8%A7%A3%E6%9E%90%E7%9A%84%E5%87%BD%E6%95%B8%E5%9C%B0%E5%9D%80%5D%20--%3E%20Success%0A"}}),n("p",[s._v("如果寫成 pseudo code ( 感謝 "),n("a",{attrs:{href:"https://www.usenix.net/sites/default/files/conference/protected-files/sec15_slides_difederico.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("How the ELF ruined Christmas"),n("OutboundLink")],1),s._v("\n提供的程式碼 )")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" printf@"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("plt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" 是第一次呼叫 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 找到 printf 地址，將地址更新到 GOT 表，再呼叫 PLT")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_dl_runtime_resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("elf_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("printf_index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 直接跳到有放 printf 地址的 GOT 表，並跳到該項內 printf 地址執行")]),s._v("\n                jmp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("printf_got_entry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("由上面所述，你可以發現 "),n("mark",[s._v("GOT 就是快取的功能")]),s._v(" ，當 GOT 表沒有地址 (快取沒有命中)，就要用動態鏈接器去找地址並更新 GOT 表，那如果有的話就是快取命中。就直接跳到存在 GOT 元素內的函數地址執行。因此，以這個流程來說，第一次解析通常會比較慢，因為 GOT表沒有地址，要呼叫動態鏈接器執行地址解析與GOT更新，但是第二次呼叫相同的函數時，因為GOT表已經有函數地址，直接跳過去函數地址執行就好，所以第一次之後速度會變比較快。")]),s._v(" "),n("p",[s._v("如下圖，下圖左，是第一次 Call function，右是之後 Call 同 function，其實可以發現，當 "),n("mark",[s._v("GOT 若是沒有放該函數地址時，裡面的內容就是 PLT 的下一行指令，之後 PLT 會跳到 PLT 內動態鏈接的索引去執行動態鏈接")]),s._v("，這張圖很清楚地涵蓋整個動態鏈接的精華。")]),s._v(" "),n("p",[s._v("另外一張圖，也闡述的蠻清楚的，來自"),n("a",{attrs:{href:"https://hackmd.io/@rhythm/ry5pxN6NI",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux/ELF動態鏈接部分機制(GOT&PLT)"),n("OutboundLink")],1),s._v("，需要照數字走\n|"),n("img",{attrs:{src:"https://i.imgur.com/sxo16t3.png",alt:""}})]),s._v(" "),n("ol",[n("li",[s._v("call printf 函數，跳到 PLT[1] (2 的位置)")]),s._v(" "),n("li",[s._v("PLT[1] 是一段程式碼 ( PLT 內每個元素都是一些跳轉指令 )")]),s._v(" "),n("li",[s._v("程式碼第一行先跳到 GOT[2] 的地址，看看 GOT[2] 有沒有存 printf 的地址，結果沒有 printf 的地址， GOT[2]裡面放的是 PLT[1] 下一行程式碼，跳回去 PLT[1] 的下一行程式碼 (4的位置)")]),s._v(" "),n("li",[s._v("再跳去 PLT[0] ( 5 的位置 )，因為那裡有動態鏈接器的地址")]),s._v(" "),n("li",[s._v("PLT[0] 起始地址")]),s._v(" "),n("li",[s._v("呼叫動態鏈接器解析函數地址")]),s._v(" "),n("li",[s._v("更新 GOT[2] 的內容變成 pritnf 的地址")]),s._v(" "),n("li",[s._v("以後，當 call printf 時，去 GOT[2] 找就可以直接跳到 printf 的地址執行")])]),s._v(" "),n("p",[s._v("講完了 printf 的故事，那為何需要 PLT 表格 ? 為何不直接去 GOT 表格找地址，如果GOT表沒有存就直接叫動態鏈接器就好 ?  為何要多此一舉的經過 PLT 再 GOT ? 🤔🤔，這個問題在 Stackoverflow 有人在討論，在 "),n("a",{attrs:{href:"http://brandon-hy-lin.blogspot.com/2015/12/shared-library-plt-got.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Shared Library 中 PLT 和 GOT 的使用機制"),n("OutboundLink")],1),s._v(" 和  "),n("a",{attrs:{href:"https://stackoverflow.com/questions/43048932/why-does-the-plt-exist-in-addition-to-the-got-instead-of-just-using-the-got",target:"_blank",rel:"noopener noreferrer"}},[s._v("Why does the PLT exist in addition to the GOT, instead of just using the GOT?"),n("OutboundLink")],1),s._v("\n有提到，但是我認為都沒有回答到點上😂，這個問題我放在未解之謎。")]),s._v(" "),n("p",[s._v("接下來就是運用到我們的 debugger 來看動態鏈接的過程。")]),s._v(" "),n("h2",{attrs:{id:"三、debugger-實驗"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、debugger-實驗"}},[s._v("#")]),s._v(" 三、Debugger 實驗")]),s._v(" "),n("p",[s._v("在這裡我們使用進階的 "),n("code",[s._v("gdb-peda")]),s._v("，因為原始的 "),n("code",[s._v("gdb")]),s._v(" 雖然夠用，但是 "),n("code",[s._v("gdb-peda")]),s._v(" 可以更鉅細靡遺的展示各個暫存器資訊，執行狀態等，是個常常在逆向工程使用到的進階 debugger。安裝也是粉簡單")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/longld/peda.git ~/peda\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"source ~/peda/peda.py"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.gdbinit\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DONE! debug your program with gdb and enjoy"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("那我們就以普通的 hello world 的程式碼來分析吧 ~")]),s._v(" "),n("div",{staticClass:"language-C line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World!\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3-1-利用-readelf-看-eof-的格局及重定位符號"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-利用-readelf-看-eof-的格局及重定位符號"}},[s._v("#")]),s._v(" 3-1. 利用 Readelf 看 EOF 的格局及重定位符號")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("readelf -l hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Elf file type is DYN (Shared object file)\nEntry point 0x530\nThere are 9 program headers, starting at offset 64\n\nProgram Headers:\n  Type           Offset             VirtAddr           PhysAddr\n                 FileSiz            MemSiz              Flags  Align\n  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040\n                 0x00000000000001f8 0x00000000000001f8  R      0x8\n  INTERP         0x0000000000000238 0x0000000000000238 0x0000000000000238\n                 0x000000000000001c 0x000000000000001c  R      0x1\n      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]\n  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x00000000000008b0 0x00000000000008b0  R E    0x200000\n  LOAD           0x0000000000000db8 0x0000000000200db8 0x0000000000200db8\n                 0x0000000000000258 0x0000000000000260  RW     0x200000\n  DYNAMIC        0x0000000000000dc8 0x0000000000200dc8 0x0000000000200dc8\n                 0x00000000000001f0 0x00000000000001f0  RW     0x8\n  NOTE           0x0000000000000254 0x0000000000000254 0x0000000000000254\n                 0x0000000000000044 0x0000000000000044  R      0x4\n  GNU_EH_FRAME   0x0000000000000768 0x0000000000000768 0x0000000000000768\n                 0x000000000000003c 0x000000000000003c  R      0x4\n  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000\n                 0x0000000000000000 0x0000000000000000  RW     0x10\n  GNU_RELRO      0x0000000000000db8 0x0000000000200db8 0x0000000000200db8\n                 0x0000000000000248 0x0000000000000248  R      0x1\n\n Section to Segment mapping:\n  Segment Sections...\n   00\n   01     .interp\n   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .plt.got .text .fini .rodata .eh_frame_hdr .eh_frame\n   03     .init_array .fini_array .dynamic .got .data .bss\n   04     .dynamic\n   05     .note.ABI-tag .note.gnu.build-id\n   06     .eh_frame_hdr\n   07\n   08     .init_array .fini_array .dynamic .got\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("p",[s._v("上面可以看到，哪幾個 section 屬於同一個 segment，例如 "),n("code",[s._v(".got")]),s._v("、"),n("code",[s._v(".data")]),s._v("、"),n("code",[s._v(".bss")]),s._v(" 屬於同一個 Segment ，再來我們看看有哪些符號需要被重定位")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("readelf -r hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Relocation section '.rela.dyn' at offset 0x410 contains 8 entries:\n  Offset          Info           Type           Sym. Value    Sym. Name + Addend\n000000200db8  000000000008 R_X86_64_RELATIVE                    630\n000000200dc0  000000000008 R_X86_64_RELATIVE                    5f0\n000000201008  000000000008 R_X86_64_RELATIVE                    201008\n000000200fd8  000100000006 R_X86_64_GLOB_DAT 0000000000000000 _ITM_deregisterTMClone + 0\n000000200fe0  000300000006 R_X86_64_GLOB_DAT 0000000000000000 __libc_start_main@GLIBC_2.2.5 + 0\n000000200fe8  000400000006 R_X86_64_GLOB_DAT 0000000000000000 __gmon_start__ + 0\n000000200ff0  000500000006 R_X86_64_GLOB_DAT 0000000000000000 _ITM_registerTMCloneTa + 0\n000000200ff8  000600000006 R_X86_64_GLOB_DAT 0000000000000000 __cxa_finalize@GLIBC_2.2.5 + 0\n\nRelocation section '.rela.plt' at offset 0x4d0 contains 1 entry:\n  Offset          Info           Type           Sym. Value    Sym. Name + Addend\n000000200fd0  000200000007 R_X86_64_JUMP_SLO 0000000000000000 puts@GLIBC_2.2.5 + 0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("這個指令可以查看什麼符號需要被重定位，例如 : puts 等。而為了讓動態鏈接器確定是對哪個符號進行重定位，需要一個重定位表來儲存相關訊息\n"),n("code",[s._v(".rela.plt")]),s._v("：這個section保存了.plt中保存的符號的重定位信息。\n"),n("code",[s._v(".rela.dyn")]),s._v("：這個section保存了除了.plt中保存的符號外的其他符號的重定位信息。")]),s._v(" "),n("p",[s._v("由上面 "),n("code",[s._v("readelf")]),s._v("，可以看到各個section 的訊息，也可以看到我們以那些符號需要重定位，接下來我們需要再拉近一點距離看，會使用到 "),n("code",[s._v("objdump")])]),s._v(" "),n("h3",{attrs:{id:"_3-2-利用-objdump-更仔細看-plt-got-機制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-利用-objdump-更仔細看-plt-got-機制"}},[s._v("#")]),s._v(" 3-2. 利用 objdump 更仔細看 PLT, GOT 機制")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("objdump -D hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("hello:     file format elf64-x86-64\n\n\nDisassembly of section .init:\n\n00000000000004e8 <_init>:\n 4e8:   48 83 ec 08             sub    $0x8,%rsp\n 4ec:   48 8b 05 f5 0a 20 00    mov    0x200af5(%rip),%rax        # 200fe8 <__gmon_start__>\n 4f3:   48 85 c0                test   %rax,%rax\n 4f6:   74 02                   je     4fa <_init+0x12>\n 4f8:   ff d0                   callq  *%rax\n 4fa:   48 83 c4 08             add    $0x8,%rsp\n 4fe:   c3                      retq\n\nDisassembly of section .plt:\n\n0000000000000500 <.plt>:\n 500:   ff 35 ba 0a 20 00       pushq  0x200aba(%rip)        # 200fc0 <_GLOBAL_OFFSET_TABLE_+0x8>\n 506:   ff 25 bc 0a 20 00       jmpq   *0x200abc(%rip)        # 200fc8 <_GLOBAL_OFFSET_TABLE_+0x10>\n 50c:   0f 1f 40 00             nopl   0x0(%rax)\n\n0000000000000510 <puts@plt>:\n 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 <puts@GLIBC_2.2.5>\n 516:   68 00 00 00 00          pushq  $0x0\n 51b:   e9 e0 ff ff ff          jmpq   500 <.plt>\n\nDisassembly of section .plt.got:\n\n0000000000000520 <__cxa_finalize@plt>:\n 520:   ff 25 d2 0a 20 00       jmpq   *0x200ad2(%rip)        # 200ff8 <__cxa_finalize@GLIBC_2.2.5>\n 526:   66 90                   xchg   %ax,%ax\n\nDisassembly of section .text:\n\n0000000000000530 <_start>:\n 530:   31 ed                   xor    %ebp,%ebp\n 532:   49 89 d1                mov    %rdx,%r9\n 535:   5e                      pop    %rsi\n 536:   48 89 e2                mov    %rsp,%rdx\n 539:   48 83 e4 f0             and    $0xfffffffffffffff0,%rsp\n 53d:   50                      push   %rax\n 53e:   54                      push   %rsp\n 53f:   4c 8d 05 8a 01 00 00    lea    0x18a(%rip),%r8        # 6d0 <__libc_csu_fini>\n 546:   48 8d 0d 13 01 00 00    lea    0x113(%rip),%rcx        # 660 <__libc_csu_init>\n 54d:   48 8d 3d e6 00 00 00    lea    0xe6(%rip),%rdi        # 63a <main>\n 554:   ff 15 86 0a 20 00       callq  *0x200a86(%rip)        # 200fe0 <__libc_start_main@GLIBC_2.2.5>\n 55a:   f4                      hlt\n 55b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)\n\n0000000000000560 <deregister_tm_clones>:\n 560:   48 8d 3d a9 0a 20 00    lea    0x200aa9(%rip),%rdi        # 201010 <__TMC_END__>\n 567:   55                      push   %rbp\n 568:   48 8d 05 a1 0a 20 00    lea    0x200aa1(%rip),%rax        # 201010 <__TMC_END__>\n 56f:   48 39 f8                cmp    %rdi,%rax\n 572:   48 89 e5                mov    %rsp,%rbp\n 575:   74 19                   je     590 <deregister_tm_clones+0x30>\n 577:   48 8b 05 5a 0a 20 00    mov    0x200a5a(%rip),%rax        # 200fd8 <_ITM_deregisterTMCloneTable>\n 57e:   48 85 c0                test   %rax,%rax\n 581:   74 0d                   je     590 <deregister_tm_clones+0x30>\n 583:   5d                      pop    %rbp\n 584:   ff e0                   jmpq   *%rax\n 586:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n 58d:   00 00 00\n 590:   5d                      pop    %rbp\n 591:   c3                      retq\n 592:   0f 1f 40 00             nopl   0x0(%rax)\n 596:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n 59d:   00 00 00\n\n00000000000005a0 <register_tm_clones>:\n 5a0:   48 8d 3d 69 0a 20 00    lea    0x200a69(%rip),%rdi        # 201010 <__TMC_END__>\n 5a7:   48 8d 35 62 0a 20 00    lea    0x200a62(%rip),%rsi        # 201010 <__TMC_END__>\n 5ae:   55                      push   %rbp\n 5af:   48 29 fe                sub    %rdi,%rsi\n 5b2:   48 89 e5                mov    %rsp,%rbp\n 5b5:   48 c1 fe 03             sar    $0x3,%rsi\n 5b9:   48 89 f0                mov    %rsi,%rax\n 5bc:   48 c1 e8 3f             shr    $0x3f,%rax\n 5c0:   48 01 c6                add    %rax,%rsi\n 5c3:   48 d1 fe                sar    %rsi\n 5c6:   74 18                   je     5e0 <register_tm_clones+0x40>\n 5c8:   48 8b 05 21 0a 20 00    mov    0x200a21(%rip),%rax        # 200ff0 <_ITM_registerTMCloneTable>\n 5cf:   48 85 c0                test   %rax,%rax\n 5d2:   74 0c                   je     5e0 <register_tm_clones+0x40>\n 5d4:   5d                      pop    %rbp\n 5d5:   ff e0                   jmpq   *%rax\n 5d7:   66 0f 1f 84 00 00 00    nopw   0x0(%rax,%rax,1)\n 5de:   00 00\n 5e0:   5d                      pop    %rbp\n 5e1:   c3                      retq\n 5e2:   0f 1f 40 00             nopl   0x0(%rax)\n 5e6:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n 5ed:   00 00 00\n\n00000000000005f0 <__do_global_dtors_aux>:\n 5f0:   80 3d 19 0a 20 00 00    cmpb   $0x0,0x200a19(%rip)        # 201010 <__TMC_END__>\n 5f7:   75 2f                   jne    628 <__do_global_dtors_aux+0x38>\n 5f9:   48 83 3d f7 09 20 00    cmpq   $0x0,0x2009f7(%rip)        # 200ff8 <__cxa_finalize@GLIBC_2.2.5>\n 600:   00\n 601:   55                      push   %rbp\n 602:   48 89 e5                mov    %rsp,%rbp\n 605:   74 0c                   je     613 <__do_global_dtors_aux+0x23>\n 607:   48 8b 3d fa 09 20 00    mov    0x2009fa(%rip),%rdi        # 201008 <__dso_handle>\n 60e:   e8 0d ff ff ff          callq  520 <__cxa_finalize@plt>\n 613:   e8 48 ff ff ff          callq  560 <deregister_tm_clones>\n 618:   c6 05 f1 09 20 00 01    movb   $0x1,0x2009f1(%rip)        # 201010 <__TMC_END__>\n 61f:   5d                      pop    %rbp\n 620:   c3                      retq\n 621:   0f 1f 80 00 00 00 00    nopl   0x0(%rax)\n 628:   f3 c3                   repz retq\n 62a:   66 0f 1f 44 00 00       nopw   0x0(%rax,%rax,1)\n\n0000000000000630 <frame_dummy>:\n 630:   55                      push   %rbp\n 631:   48 89 e5                mov    %rsp,%rbp\n 634:   5d                      pop    %rbp\n 635:   e9 66 ff ff ff          jmpq   5a0 <register_tm_clones>\n\n000000000000063a <main>:\n 63a:   55                      push   %rbp\n 63b:   48 89 e5                mov    %rsp,%rbp\n 63e:   48 8d 3d 9f 00 00 00    lea    0x9f(%rip),%rdi        # 6e4 <_IO_stdin_used+0x4>\n 645:   e8 c6 fe ff ff          callq  510 <puts@plt>\n 64a:   b8 00 00 00 00          mov    $0x0,%eax\n 64f:   5d                      pop    %rbp\n 650:   c3                      retq\n 651:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n 658:   00 00 00\n 65b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)\n\n0000000000000660 <__libc_csu_init>:\n 660:   41 57                   push   %r15\n 662:   41 56                   push   %r14\n 664:   49 89 d7                mov    %rdx,%r15\n 667:   41 55                   push   %r13\n 669:   41 54                   push   %r12\n 66b:   4c 8d 25 46 07 20 00    lea    0x200746(%rip),%r12        # 200db8 <__frame_dummy_init_array_entry>\n 672:   55                      push   %rbp\n 673:   48 8d 2d 46 07 20 00    lea    0x200746(%rip),%rbp        # 200dc0 <__init_array_end>\n 67a:   53                      push   %rbx\n 67b:   41 89 fd                mov    %edi,%r13d\n 67e:   49 89 f6                mov    %rsi,%r14\n 681:   4c 29 e5                sub    %r12,%rbp\n 684:   48 83 ec 08             sub    $0x8,%rsp\n 688:   48 c1 fd 03             sar    $0x3,%rbp\n 68c:   e8 57 fe ff ff          callq  4e8 <_init>\n 691:   48 85 ed                test   %rbp,%rbp\n 694:   74 20                   je     6b6 <__libc_csu_init+0x56>\n 696:   31 db                   xor    %ebx,%ebx\n 698:   0f 1f 84 00 00 00 00    nopl   0x0(%rax,%rax,1)\n 69f:   00\n 6a0:   4c 89 fa                mov    %r15,%rdx\n 6a3:   4c 89 f6                mov    %r14,%rsi\n 6a6:   44 89 ef                mov    %r13d,%edi\n 6a9:   41 ff 14 dc             callq  *(%r12,%rbx,8)\n 6ad:   48 83 c3 01             add    $0x1,%rbx\n 6b1:   48 39 dd                cmp    %rbx,%rbp\n 6b4:   75 ea                   jne    6a0 <__libc_csu_init+0x40>\n 6b6:   48 83 c4 08             add    $0x8,%rsp\n 6ba:   5b                      pop    %rbx\n 6bb:   5d                      pop    %rbp\n 6bc:   41 5c                   pop    %r12\n 6be:   41 5d                   pop    %r13\n 6c0:   41 5e                   pop    %r14\n 6c2:   41 5f                   pop    %r15\n 6c4:   c3                      retq\n 6c5:   90                      nop\n 6c6:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n 6cd:   00 00 00\n\n00000000000006d0 <__libc_csu_fini>:\n 6d0:   f3 c3                   repz retq\n\nDisassembly of section .fini:\n\n00000000000006d4 <_fini>:\n 6d4:   48 83 ec 08             sub    $0x8,%rsp\n 6d8:   48 83 c4 08             add    $0x8,%rsp\n 6dc:   c3                      retq\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br")])]),n("p",[s._v("雖然產生出一大串文字，但是仔細看，我們可以發現一些蛛絲馬跡，首先 "),n("code",[s._v("<main>")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("000000000000063a <main>:\n 63a:   55                      push   %rbp\n 63b:   48 89 e5                mov    %rsp,%rbp\n 63e:   48 8d 3d 9f 00 00 00    lea    0x9f(%rip),%rdi        # 6e4 <_IO_stdin_used+0x4>\n 645:   e8 c6 fe ff ff          callq  510 <puts@plt>\n 64a:   b8 00 00 00 00          mov    $0x0,%eax\n 64f:   5d                      pop    %rbp\n 650:   c3                      retq\n 651:   66 2e 0f 1f 84 00 00    nopw   %cs:0x0(%rax,%rax,1)\n 658:   00 00 00\n 65b:   0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("code",[s._v("call 510 <puts@plt>")]),s._v(": 跳到 PLT 表 510 的位置，接下來就是關鍵所在😀")]),s._v(" "),n("p",[s._v("我們先看 PLT 表格，每一個元素真的都是放一段指令碼，而且大同小異，短短三行涵蓋精隨，在第一個元素 "),n("code",[s._v("<.plt>")]),s._v("，就是去呼叫 resolver 的指令，")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("objdump -d -j .plt hello \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Disassembly of section .plt:\n\n0000000000000500 <.plt>:\n 500:   ff 35 ba 0a 20 00       pushq  0x200aba(%rip)        # 200fc0 <_GLOBAL_OFFSET_TABLE_+0x8>\n 506:   ff 25 bc 0a 20 00       jmpq   *0x200abc(%rip)        # 200fc8 <_GLOBAL_OFFSET_TABLE_+0x10>\n 50c:   0f 1f 40 00             nopl   0x0(%rax)\n\n0000000000000510 <puts@plt>:\n 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 <puts@GLIBC_2.2.5>\n 516:   68 00 00 00 00          pushq  $0x0\n 51b:   e9 e0 ff ff ff          jmpq   500 <.plt>\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("所以你看第二個元素")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("0000000000000510 <puts@plt>:\n 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 <puts@GLIBC_2.2.5>\n 516:   68 00 00 00 00          pushq  $0x0\n 51b:   e9 e0 ff ff ff          jmpq   500 <.plt>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("第一行，當 GOT 表格內容有 put 函數地址，就跳過去 put 地址執行，那 GOT 表格該項的地址由 "),n("code",[s._v("*0x200aba(%rip)")]),s._v(" 得到，這行指令是 rip 值 + "),n("code",[s._v("0x200aba")]),s._v("， "),n("mark",[s._v("rip 暫存器值是下一個執行指令的地址")]),s._v("，以這裡為例")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("0x516 + 0x200aba = 0x200fd0 = 我們要去 GOT 找的項目地址，可能是 GOT[1], GOT[2]... \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("第二、三行，就是當 GOT 表項內存的是 0x516，表示沒有該符號的地址， "),n("mark",[s._v("我們就必須跳回來執行，因為要去找動態鏈接器的地址")]),s._v("，那如同前面所述，動態鏈接器通常就在 PLT 表格的第一項，所以可以看到有 "),n("code",[s._v("jmpq 500 <.plt>")]),s._v("，又跳到 PLT 第一項，去找我們的動態鏈接器求救。")]),s._v(" "),n("p",[s._v("那我們去循線找看看，GOT表的內容物吧")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("objdump -d -j .got hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("hello:     file format elf64-x86-64\nDisassembly of section .got:\n\n0000000000200fb8 <_GLOBAL_OFFSET_TABLE_>:\n  200fb8:       c8 0d 20 00 00 00 00 00 00 00 00 00 00 00 00 00     .. .............\n        ...\n  200fd0:       16 05 00 00 00 00 00 00 00 00 00 00 00 00 00 00     ................\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("你會發現有兩個項目")]),s._v(" "),n("ul",[n("li",[s._v("GOT[0]: 200fb8: c8 0d 20 00 00 00 00 00 00 00 00 00 00 00 00 00")]),s._v(" "),n("li",[s._v("GOT[1]: 200fd0: 16 05 00 00 00 00 00 00 00 00 00 00 00 00 00 00")])]),s._v(" "),n("p",[s._v("在剛剛 PLT 表格，我們剛剛計算他跳到的地址是")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("0x516 + 0x200aba = 0x200fd0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("就是我們 GOT[1] 那項，該內容是 "),n("code",[s._v("0x516")]),s._v("，0x516 是哪裡 ? 就是剛剛 PLT 的指令地址")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("0000000000000510 <puts@plt>:\n 510:   ff 25 ba 0a 20 00       jmpq   *0x200aba(%rip)        # 200fd0 <puts@GLIBC_2.2.5>\n 516:   68 00 00 00 00          pushq  $0x0\n 51b:   e9 e0 ff ff ff          jmpq   500 <.plt>\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("是不是串起來了 ? 當 GOT 內沒有函數地址，就會叫你跳回去找動態鏈接器。")]),s._v(" "),n("p",[s._v("所以流程就是")]),s._v(" "),n("Mermaid",{attrs:{id:"mermaid-64a568e8","data-code":"graph%20TD%0A%20%20%20%20main(%22645%3A%20%20%20e8%20c6%20fe%20ff%20ff%20%20%20%20%20%20%20%20%20%20callq%20%20510%20%3Cputs%40plt%3E%22)%0A%20%20%20%20plt1(%22510%3A%20%20%20ff%2025%20ba%200a%2020%2000%20%20%20%20%20%20%20jmpq%20%20%20*0x200aba(%25rip)%20%20%20%20%20%20%20%20%23%20200fd0%20%3Cbr%3E516%3A%20%20%2068%2000%2000%2000%2000%20%20%20%20%20%20%20%20%20%20pushq%20%20%240x0%20%3Cbr%3E%2051b%3A%20%20%20e9%20e0%20ff%20ff%20ff%20%20%20%20%20%20%20%20%3Cbr%3Ejmpq%20%20%20500%20%3C.plt%3E%22)%0A%20%20%20%20got(%22GOT%5B1%5D%3A%20200fd0%3A%2016%2005%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%2000%22)%0A%20%20%20%20main%20--%3E%7C1.%200x510%7C%20plt1%20--%3E%7C2.%200x200fd0%7C%20got%20--%3E%20%7C3.%200x516%7C%20plt1%0A%20%20%20%20plt1%20--%3E%7C4.%200x516%7C%20plt2(%220000000000000500%20%3C.plt%3E...%22)%20--%3E%20dl(%22dynamic%20linker%22)%0A%20%20%20%20dl%20--%3E%20%7C%225.%20%E6%89%BE%E5%88%B0%E5%9C%B0%E5%9D%80%E6%9B%B4%E6%96%B0GOT%5B1%5D%22%7C%20got%0A%20%20%20%20dl%20--%3E%20exec(%22%E5%9F%B7%E8%A1%8C%20put%20%E5%87%BD%E6%95%B8%22)%0A"}}),n("p",[s._v("利用 "),n("code",[s._v("objdump")]),s._v(" 後，我們又更了解他的跳轉原理。😉")]),s._v(" "),n("h3",{attrs:{id:"_3-3-利用-gdb-peda-動手追蹤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-利用-gdb-peda-動手追蹤"}},[s._v("#")]),s._v(" 3-3. 利用 gdb-peda 動手追蹤")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb ./hello\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("我們先來在 main 函數下斷點")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("b *main\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("再執行")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("r\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://i.imgur.com/FciAF2i.png",alt:""}}),s._v("\n有沒有看到美麗的儀表板🤣，接下來就可以利用 "),n("code",[s._v("gdb-peda")]),s._v(" 的強大的功能了，接下來我們來反組譯 "),n("code",[s._v("put")]),s._v(" 那行，這一行就是跳轉到 PLT 的指令。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("   0x8000631 <frame_dummy+1>:   mov    rbp,rsp\n   0x8000634 <frame_dummy+4>:   pop    rbp\n   0x8000635 <frame_dummy+5>:   jmp    0x80005a0 <register_tm_clones>\n=> 0x800063a <main>:    push   rbp\n   0x800063b <main+1>:  mov    rbp,rsp\n   0x800063e <main+4>:  lea    rdi,[rip+0x9f]        # 0x80006e4\n   0x8000645 <main+11>: call   0x8000510 <puts@plt>\n   0x800064a <main+16>: mov    eax,0x0\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("你可以發現在上一章節的地址 0x510，那因為載入到記憶體起始位置有改變，所以要平移，"),n("code",[s._v("3-1")]),s._v(" 和 "),n("code",[s._v("3-2")]),s._v(" 起始位置是 0，因為還沒載入到記憶體，但是載入後，起始位置是 "),n("code",[s._v("0x8000510")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ pdisass 0x8000510\nDump of assembler code from 0x8000510 to 0x8000530::    Dump of assembler code from 0x8000510 to 0x8000530:\n   0x0000000008000510 <puts@plt+0>:     jmp    QWORD PTR [rip+0x200aba]        # 0x8200fd0\n   0x0000000008000516 <puts@plt+6>:     push   0x0\n   0x000000000800051b <puts@plt+11>:    jmp    0x8000500\n   0x0000000008000520 <__cxa_finalize@plt+0>:   jmp    QWORD PTR [rip+0x200ad2]        # 0x8200ff8\n   0x0000000008000526 <__cxa_finalize@plt+6>:   xchg   ax,ax\n   0x0000000008000528:  add    BYTE PTR [rax],al\n   0x000000000800052a:  add    BYTE PTR [rax],al\n   0x000000000800052c:  add    BYTE PTR [rax],al\n   0x000000000800052e:  add    BYTE PTR [rax],al\nEnd of assembler dump.\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("我們再循線下去，我們反組譯 GOT 表格地址 "),n("code",[s._v("0x8200fd0")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ disassemble 0x8200fd0\nDump of assembler code for function _GLOBAL_OFFSET_TABLE_:\n   0x0000000008200fb8:  enter  0x200d,0x0\n   0x0000000008200fbc:  add    BYTE PTR [rax],al\n   0x0000000008200fbe:  add    BYTE PTR [rax],al\n   0x0000000008200fc0:  add    BYTE PTR [rax],al\n   0x0000000008200fc2:  add    BYTE PTR [rax],al\n   0x0000000008200fc4:  add    BYTE PTR [rax],al\n   0x0000000008200fc6:  add    BYTE PTR [rax],al\n   0x0000000008200fc8:  add    BYTE PTR [rax],al\n   0x0000000008200fca:  add    BYTE PTR [rax],al\n   0x0000000008200fcc:  add    BYTE PTR [rax],al\n   0x0000000008200fce:  add    BYTE PTR [rax],al\n   0x0000000008200fd0:  movabs al,ds:0x7fffff080a\n   0x0000000008200fd9:  add    BYTE PTR [rax],al\n   0x0000000008200fdb:  add    BYTE PTR [rax],al\n   0x0000000008200fdd:  add    BYTE PTR [rax],al\n   0x0000000008200fdf:  add    BYTE PTR [rax],dl\n   0x0000000008200fe1:  sbb    eax,DWORD PTR [rdx]\n   0x0000000008200fe3:  (bad)\n   0x0000000008200fe4:  (bad)\n   0x0000000008200fe5:  jg     0x8200fe7\n   0x0000000008200fe7:  add    BYTE PTR [rax],al\n   0x0000000008200fe9:  add    BYTE PTR [rax],al\n   0x0000000008200feb:  add    BYTE PTR [rax],al\n   0x0000000008200fed:  add    BYTE PTR [rax],al\n   0x0000000008200fef:  add    BYTE PTR [rax],al\n   0x0000000008200ff1:  add    BYTE PTR [rax],al\n   0x0000000008200ff3:  add    BYTE PTR [rax],al\n   0x0000000008200ff5:  add    BYTE PTR [rax],al\n   0x0000000008200ff7:  add    BYTE PTR [rax+0x36],al\n   0x0000000008200ffa:  add    al,0xff\n   0x0000000008200ffc:  (bad)\n   0x0000000008200ffd:  jg     0x8200fff\n   0x0000000008200fff:  add    BYTE PTR [rax],al\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("p",[s._v("可以看到 "),n("code",[s._v("0x0000000008200fd0: movabs al,ds:0x7fffff080a")]),s._v("，儲存一個地址，那個就是 put 函數的地址，這裡有幾種方式可以確認是 put 函數地址")]),s._v(" "),n("ol",[n("li",[s._v("利用 "),n("code",[s._v("tele")]),s._v(" 指令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ tele 0x8200fd0\n0000| 0x8200fd0 --\x3e 0x7fffff080aa0 (<_IO_puts>: push   r13)\n0008| 0x8200fd8 --\x3e 0x0\n0016| 0x8200fe0 --\x3e 0x7fffff021b10 (<__libc_start_main>:        push   r13)\n0024| 0x8200fe8 --\x3e 0x0\n0032| 0x8200ff0 --\x3e 0x0\n0040| 0x8200ff8 --\x3e 0x7fffff043640 (<__cxa_finalize>:   push   r15)\n0048| 0x8201000 --\x3e 0x0\n0056| 0x8201008 (0x0000000008201008)\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("利用 "),n("code",[s._v("xinfo")]),s._v(" 指令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ xinfo 0x8200fd0\n0x8200fd0 --\x3e 0x7fffff080aa0 (<_IO_puts>:       push   r13)\nVirtual memory mapping:\nStart : 0x08200000\nEnd   : 0x08201000\nOffset: 0xfd0\nPerm  : r--p\nName  : /mnt/c/Users/lovel/Desktop/linker/hello\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("利用 "),n("code",[s._v("print")]),s._v(" 指令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ print puts\n$1 = {int (const char *)} 0x7fffff080aa0 <_IO_puts>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("當然，你也可以直接看 PLT 的項目名稱得知")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ x/16x 0x0000000008000510\n0x8000510 <puts@plt>:   0x0aba25ff      0x00680020      0xe9000000      0xffffffe0\n0x8000520 <__cxa_finalize@plt>: 0x0ad225ff      0x90660020      0x00000000      0x00000000\n0x8000530 <_start>:     0x8949ed31      0x89485ed1      0xe48348e2      0x4c5450f0\n0x8000540 <_start+16>:  0x018a058d      0x8d480000      0x0001130d      0x3d8d4800\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("還真的是 "),n("code",[s._v("puts")]),s._v(" 函數地址，那接下來我們要確認是否為 "),n("code",[s._v("libc.so")]),s._v(" 的符號，利用 "),n("code",[s._v("info symbol")]),s._v(" 查看")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gdb-peda$ info symbol puts\nputs in section .text of /lib/x86_64-linux-gnu/libc.so.6\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("我們更加確定，透過 GOT 儲存的 "),n("code",[s._v("put")]),s._v("地址，就直接跳到 "),n("code",[s._v("libc.so")]),s._v(" 的程式碼區段去執行 ~")]),s._v(" "),n("p",[s._v("咦 !? 為什麼你的 GDB 追蹤，GOT 直接就有地址值了，沒有再跳回去 PLT 重新解析，這裡有個比較奇怪的地方，就是載入時就幫你做好符號解析了，GOT表就存放 "),n("code",[s._v("puts")]),s._v(" 的函數地址，不需要再去叫動態鏈接器做事，其實很多參考連結，都可以追蹤到 "),n("code",[s._v("dl_runtime_resolve")]),s._v(" 的函數，但我這裡總是沒追到。")]),s._v(" "),n("p",[s._v("我認為有可能是比較新的載入器(loader)設計對動態鏈結符號解析有再做一些最佳化，"),n("a",{attrs:{href:"https://hackmd.io/@rhythm/ry5pxN6NI",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux/ELF動態鏈接部分機制(GOT&PLT)"),n("OutboundLink")],1),s._v(" 也有遇到相同問題。經過了幾番尋找，這正是下一篇介紹的技術 - "),n("code",[s._v("prelink")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_3-4-aslr-and-prelink-技術"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-aslr-and-prelink-技術"}},[s._v("#")]),s._v(" 3-4. ASLR and Prelink 技術")]),s._v(" "),n("p",[s._v("在上一個小節，我們用 "),n("code",[s._v("gdb")]),s._v(" 來追查動態鏈結的行為，卻發現 GOT 表沒有經過動態鏈結器就存放了 "),n("code",[s._v("put")]),s._v(" 的地址， "),n("mark",[s._v("好像是預先就做好符號解析一樣")]),s._v("，沒錯，回到動態鏈結，你可以發現最原始動態鏈結的方法會帶來一些成本，每次重新啟動時都要重新解析符號地址。解析時又要額外叫動態鏈接器來幫忙。一來一回會浪費很多 CPU cycle 去執行，假設今天要解析一千萬個符號，我相信動態鏈接重定位符號的時間一定佔用不少執行期時間。所以今天在現代作業系統就有更進一步的作法 - "),n("code",[s._v("預鏈接(prelink)")]),s._v("。")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Prelink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prelink wiki"),n("OutboundLink")],1)]),s._v(" "),n("ol",[n("li",[s._v("定義")])]),s._v(" "),n("blockquote",[n("p",[s._v("In computing, prebinding, also called prelinking, is a method for optimizing application load times by resolving library symbols prior to launch.")])]),s._v(" "),n("p",[s._v("Prelink 是一個在程式執行前先解析函式庫符號地址的一種最佳化方法。這也可以對應到，我們在 3-1、3-2 小節看到還沒執行時的，GOT[1] 表放的是 PLT 下一個地址，但在執行時就馬上有 put 函數的地址，好像是某個無名英雄默默行善，或是像 JOJO 第五部大魔王迪亞波羅的替身緋紅之王的能力 - 時間刪除。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2FD7OUe6PTQvqaXHT1GHsEVmwlkQmXvalOQVXnqs5wm3ogT1564321178485.jpeg&thumbnail=650x2147483647&quality=80&type=jpg",alt:""}})]),s._v(" "),n("p",[s._v("扯遠了🤣，這個無名英雄就是 "),n("code",[s._v("Prelink")]),s._v("，在維基中也有提到")]),s._v(" "),n("blockquote",[n("p",[s._v("While dynamic linking has advantages in code size and management, there are drawbacks as well. Every time a program is run, the loader needs to resolve (find) the relevant libraries. Since libraries move around in memory, there is a performance penalty for resolution. This penalty increases for each additional library needing resolution.\nPrelinking reduces this penalty by resolving libraries in advance. Afterward, resolution only occurs if the libraries have changed since being prelinked, such as following perhaps an upgrade.")])]),s._v(" "),n("p",[s._v("當事先做鏈接，有個好處就是可以在執行執行得更快，GOT 表格就已經更新好了，不用執行時做解析當然可以跑得更快 ! 而且最後面提到，如果函式庫更新才需要做地址重定位重解析。")]),s._v(" "),n("p",[s._v("在"),n("a",{attrs:{href:"https://www.twblogs.net/a/5c7d7b8ebd9eee114211f91d",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 Prelink 加速程序啓動"),n("OutboundLink")],1),s._v("，一文中，也有介紹")]),s._v(" "),n("blockquote",[n("p",[s._v("Prelink 是 Red Hat 開發者 Jakub Jelinek 所設計的工具。正如其名字所示，Prelink 利用事先鏈接代替運行時鏈接的方法來加速共享庫的加載。它不僅可以加快起動速度，還可以減少部分內存開銷，是各種 Linux 架構上用於減少程序載入時間、縮短系統啓動時間和加快應用程序啓動的很受歡迎的一個工具。\n"),n("mark",[s._v("Prelink 工具的原理主要基於這樣一個事實：動態鏈接和加載的過程開銷很大，並且在大多數的系統上，函數庫並不會常常被更動，每次程序被執行時所進行的鏈接動作都是完全相同的")]),s._v(" ，對於嵌入式系統來說尤其如此。因此，這一過程可以改在執行前就可以預先處理好，即花一些時間利用 Prelink 工具對動態共享庫和可執行文件進行處理，修改這些二進制文件並加入相應的重定位等信息，"),n("mark",[s._v("節約了本來在程序啓動時的比較耗時的查詢函數地址等工作，這樣可以減少程序啓動的時，同時也減少了內存的耗用。")]),s._v(" "),n("mark",[s._v("Prelink 的這種做法當然也有代價：每次更新動態共享庫時，相關的可執行文件都需要重新執行一遍 Prelink 才能保證有效，因爲新的共享庫中的符號信息、地址等很可能與原來的已經不同了。這種代價對於嵌入式系統的開發者來說可能稍微帶來一些複雜度，不過好在對用戶來說幾乎是可以忽略的。")])])]),s._v(" "),n("p",[s._v("你對 "),n("code",[s._v("Prelink")]),s._v(" 可能就一些理解了，簡單來說就是預先處理好引用符號地址到 GOT 表，真正載入後執行就可以直接把 GOT 當快取去執行函數。")]),s._v(" "),n("p",[s._v("在程式啓動時，當調用 printf 的時候，程序會將處理權交給 loader，由其負責在行程以及其鏈接的動態庫中查找 printf 的函數地址。由於 loader 不知道 printf 是在哪個動態庫，所以它將在整個行程和動態庫的範圍內查找。更糟糕的是在 C++ 程序中，符號的命名是類名+函數名，這導致在做字符串比較時，往往直到字符串的結尾才能獲得結果。")]),s._v(" "),n("p",[s._v("這就導致了，在行程啓動過程中，符號查找往往佔據了大部分時間。據統計，在 Linux 的 KDE 進程中啓動過程中，"),n("mark",[s._v("符號查找表竟佔據了行程啓動 80% 的時間")]),s._v(" 。有沒有辦法來改進呢？如果進程在執行前，就能獲知動態庫的加載地址，那麼函數調用的地址就應該是已知的，我們就可以通過修改執行程序，來避免符號的查找。從而節省行程啓動的時間。")]),s._v(" "),n("p",[s._v("另外和 dynamic linker 跟 prelink 有關的技術，是 ASLR(Address Space Layout Randomization)，簡單來說就是每次載入時函式庫的基本地址是隨機的，如下")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("unix$ ldd hello\n        linux-vdso.so.1 (0x00007fffe3188000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa6ccff0000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007fa6cd800000)\n\nunix$ ldd hello\n        linux-vdso.so.1 (0x00007fffd6150000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f6b26ce0000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f6b27400000)\n\nunix$ ldd hello\n        linux-vdso.so.1 (0x00007fffe9e6a000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f664d7e0000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f664de00000)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("你也可以利用 "),n("code",[s._v("strace ./hello")]),s._v(" 看看用到的 "),n("code",[s._v("System Call")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('execve("./hello", ["./hello"], 0x7ffffea85260 /* 21 vars */) = 0\nbrk(NULL)                               = 0x7fffe8b5d000\naccess("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)\naccess("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3\nfstat(3, {st_mode=S_IFREG|0644, st_size=46345, ...}) = 0\nmmap(NULL, 46345, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f6966ed8000\nclose(3)                                = 0\naccess("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)\nopenat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3\nread(3, "\\177ELF\\2\\1\\1\\3\\0\\0\\0\\0\\0\\0\\0\\0\\3\\0>\\0\\1\\0\\0\\0\\20\\35\\2\\0\\0\\0\\0\\0"..., 832) = 832\nfstat(3, {st_mode=S_IFREG|0755, st_size=2030928, ...}) = 0\nmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f6966ed0000\nmmap(NULL, 4131552, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f6966800000\nmprotect(0x7f69669e7000, 2097152, PROT_NONE) = 0\nmmap(0x7f6966be7000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f6966be7000\nmmap(0x7f6966bed000, 15072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f6966bed000\nclose(3)                                = 0\narch_prctl(ARCH_SET_FS, 0x7f6966ed14c0) = 0\nmprotect(0x7f6966be7000, 16384, PROT_READ) = 0\nmprotect(0x7f6967200000, 4096, PROT_READ) = 0\nmprotect(0x7f6966e29000, 4096, PROT_READ) = 0\nmunmap(0x7f6966ed8000, 46345)           = 0\nfstat(1, {st_mode=S_IFCHR|0660, st_rdev=makedev(4, 3), ...}) = 0\nioctl(1, TCGETS, {B38400 opost isig icanon echo ...}) = 0\nbrk(NULL)                               = 0x7fffe8b5d000\nbrk(0x7fffe8b7e000)                     = 0x7fffe8b7e000\nwrite(1, "Hello World!\\n", 13Hello World!\n)          = 13\nexit_group(0)                           = ?\n+++ exited with 0 +++\n')])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("最後，如果想知道如何結合 ASLR 和 prelink 機制，可以參考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://cosmoss-vt.github.io/pages/pubs/prelink-yoon-esa14.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dynamic-prelink: An Enhanced Prelinking Mechanism without Modifying Shared Libraries"),n("OutboundLink")],1),s._v("，以後有時間會分享文章。")])]),s._v(" "),n("h3",{attrs:{id:"_3-5-靜態鏈結和動態鏈結的比較"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-靜態鏈結和動態鏈結的比較"}},[s._v("#")]),s._v(" 3-5. 靜態鏈結和動態鏈結的比較")]),s._v(" "),n("p",[s._v("參考至 "),n("a",{attrs:{href:"https://stackoverflow.com/questions/1993390/static-linking-vs-dynamic-linking",target:"_blank",rel:"noopener noreferrer"}},[s._v("Static linking vs dynamic linking"),n("OutboundLink")],1),s._v("，比較動態鏈接跟靜態鏈接的優缺點")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("靜態鏈結 (Static link)")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("優點")]),s._v(" "),n("ol",[n("li",[s._v("啟動速度比動態鏈結稍微快一點(但也取決於技術)")]),s._v(" "),n("li",[s._v("因為他將所有需要的東西、函式庫打包，靜態連結後的執行檔案更容易在不同環境順利執行")]),s._v(" "),n("li",[s._v("很適合在有限的資源環境下(開機程序、救援模式等)")])])]),s._v(" "),n("li",[n("p",[s._v("缺點")]),s._v(" "),n("ol",[n("li",[s._v("程式肥胖，耗硬碟、記憶體資源")]),s._v(" "),n("li",[s._v("更新函式庫時要重新編譯鏈結打包")])])])])]),s._v(" "),n("li",[n("p",[s._v("動態鏈結 (Dynamic link)")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("優點")]),s._v(" "),n("ol",[n("li",[s._v("動態鏈結程式占用記憶體、硬碟空間較小")]),s._v(" "),n("li",[s._v("延遲綁定(lazy binding)機制")]),s._v(" "),n("li",[s._v("幾乎無痛更新函式庫，程式也可以順利執行")])])]),s._v(" "),n("li",[n("p",[s._v("缺點")]),s._v(" "),n("ol",[n("li",[s._v("每次都要重新解析符號地址，動態鏈接器會占用執行期不少的CPU時間，改善的機制為prelink")]),s._v(" "),n("li",[s._v("DLL Hell - 更新函式庫發生的問題，導致程式無法順利執行")])])])])])]),s._v(" "),n("h2",{attrs:{id:"四、未解之謎"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、未解之謎"}},[s._v("#")]),s._v(" 四、未解之謎")]),s._v(" "),n("ol",[n("li",[s._v("為何需要 PLT，不直接使用 GOT 就好，GOT 內預設放 resolver 地址，如果還沒解析就去更新這個表項，有的話就直接跳轉 ?")])]),s._v(" "),n("p",[s._v("參考這篇 "),n("a",{attrs:{href:"https://stackoverflow.com/questions/43048932/why-does-the-plt-exist-in-addition-to-the-got-instead-of-just-using-the-got",target:"_blank",rel:"noopener noreferrer"}},[s._v("Why does the PLT exist in addition to the GOT, instead of just using the GOT?"),n("OutboundLink")],1)]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("如何關掉 prelink 的機制，這樣我比較好追蹤 GOT PLT 的機制 🤣")])]),s._v(" "),n("h3",{attrs:{id:"🎉-2021-09-26-解開-一切都是-gcc-的鍋-🎉"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#🎉-2021-09-26-解開-一切都是-gcc-的鍋-🎉"}},[s._v("#")]),s._v(" 🎉 2021/09/26 解開 - 一切都是 GCC 的鍋 🎉")]),s._v(" "),n("p",[s._v("之後我又回來複習一遍時，深入去找原因，為什麼我的 PLT 總是已經被鏈接好了 ?")]),s._v(" "),n("p",[s._v("在看到 "),n("a",{attrs:{href:"https://ypl.coffee/dl-resolve/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Understanding _dl_runtime_resolve()"),n("OutboundLink")],1),s._v(" 後，我就發現該作者下了 "),n("code",[s._v("gcc -Wl,-z,lazy -o hello hello.c")]),s._v(" 當中的 lazy 選項，為什麼要 "),n("mark",[s._v("顯式指定 lazy")]),s._v("，隨後我使用 "),n("code",[s._v('ld --help | grep "\\-z lazy"')]),s._v(" 指令查詢，得到下列結果")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" -z lazy                     Mark object lazy runtime binding (default)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("咦 ? 那為何預設是 lazy binding 但是卻預先鏈結好了? 直到我找到了這一篇\n"),n("a",{attrs:{href:"https://stackoverflow.com/questions/62527697/why-does-gcc-link-with-z-now-by-default-although-lazy-binding-is-the-default",target:"_blank",rel:"noopener noreferrer"}},[s._v("Why does gcc link with '-z now' by default, although lazy binding is the default for ld?"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("問問題的人問為什麼 ld 預設是 "),n("code",[s._v("-z lazy")]),s._v("，但是 gcc 卻自動送給 linker "),n("code",[s._v("-z now -z relro")]),s._v("  請 linker 馬上鏈結跟重定位")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("gcc --verbose -o hello_link hello.c\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("COLLECT_GCC_OPTIONS='-v' '-o' 'hello_link' '-mtune=generic' '-march=x86-64'\n /usr/lib/gcc/x86_64-linux-gnu/7/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/7/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper -plugin-opt=-fresolution=/tmp/cceRjjri.res -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr -m elf_x86_64 --hash-style=gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie \n -z now -z relro -o hello_link /\n usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/7/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/7 -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/7/../../.. /tmp/ccdANW6g.o -lgcc --push-state --as-needed -lgcc_s --pop-state -lc -lgcc --push-state --as-needed -lgcc_s --pop-state /usr/lib/gcc/x86_64-linux-gnu/7/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/crtn.o\nCOLLECT_GCC_OPTIONS='-v' '-o' 'hello_link' '-mtune=generic' '-march=x86-64'\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("我就馬上知道了，因為我之前的編譯方式是 "),n("code",[s._v("gcc -g -Wall hell.c -o hello")]),s._v("，gcc 會自動預設送 "),n("code",[s._v("-z now -z relro")]),s._v("，難怪會這樣 = =，害我都追蹤不到動態鏈結器跟 Lazy-binding 機制。但是其實這麼做是有原因的\n"),n("mark",[s._v("因為 GOT 在 lazy binding 時會變成可寫的記憶體區段，會遭受 GOT hijacking(overwrite) 的攻擊")]),s._v("，如果載入前就鏈結好，就可以把GOT變成唯讀區段，就會比較安全，此種方法叫做 "),n("mark",[s._v("RELRO: RELocation Read-Only")]),s._v("，是 ubuntu 16.10 引進的名為\n"),n("mark",[s._v("ELF binary hardening feature")]),s._v("，所以如果往後要自行追蹤 GOT 時，用 gcc 編譯時要記得顯式加入 "),n("code",[s._v("-z lazy")]),s._v(" 不然就是自行手動鏈結。")]),s._v(" "),n("p",[s._v("另外因為這個謎底解開，也發現前面有些錯誤，GOT 表其實前三項是原本就有定義的，但是若先鏈結好，就可以從 GOT[1] 開始放符號位置了，因為不再需要動態鏈結器幫忙解析跟重定位了。")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("GOT 項")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("GOT[0]")]),s._v(" "),n("td",[s._v("紀錄執行檔的 .dynamic section 的位置，這section紀錄很多動態鏈結器的需要知道的資訊(此執行檔相依的函式庫等)，做初始化的動作")])]),s._v(" "),n("tr",[n("td",[s._v("GOT[1]")]),s._v(" "),n("td",[s._v("放 link_map 的 結構體的 doubly linked list，內有紀錄函式庫路徑跟名稱等資訊，初始值是 0，但是等動態鏈結器初始化後得到所有的相依函式庫的資訊，就會用這種方式串起來，隨後有要解析的符號就會一個一個相依的函式庫下去找")])]),s._v(" "),n("tr",[n("td",[s._v("GOT[2]")]),s._v(" "),n("td",[s._v("一樣初始值是 0，等動態鏈結器初始化完後才有值，這裡放 _dl_runtime_resolve() 的函式地址，把 link_map 傳入就可以開始解析未知的符號並修改 GOT 表")])])])]),s._v(" "),n("p",[s._v("GCC 幫我們處理很多事情，若是我們忽略其中的細節，就會不小心踩到坑。😂😂😂")]),s._v(" "),n("h3",{attrs:{id:"參考連結"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#參考連結"}},[s._v("#")]),s._v(" 參考連結")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://ypl.coffee/dl-resolve/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Understanding _dl_runtime_resolve()"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://hockeyinjune.medium.com/relro-relocation-read-only-c8d0933faef3",target:"_blank",rel:"noopener noreferrer"}},[s._v("RELRO: RELocation Read-Only"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.redhat.com/en/blog/hardening-elf-binaries-using-relocation-read-only-relro",target:"_blank",rel:"noopener noreferrer"}},[s._v("Hardening ELF binaries using Relocation Read-Only (RELRO)"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://stackoverflow.com/questions/62527697/why-does-gcc-link-with-z-now-by-default-although-lazy-binding-is-the-default",target:"_blank",rel:"noopener noreferrer"}},[s._v("Why does gcc link with '-z now' by default, although lazy binding is the default for ld?"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"五、結論"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、結論"}},[s._v("#")]),s._v(" 五、結論")]),s._v(" "),n("p",[s._v("這篇文章我承認自己是覺得還需要再整理，因為動態鏈結機制相對較複雜。後期針對動態鏈接的最佳化論文可能還要去分析一下。那以這張很棒的圖做為結尾😀")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://mdimg.wxwenku.com/getimg/356ed03bdc643f9448b3f6485edc229bb583d3da773c5e44937ad7333eec08f9ee8d6dada3b5682d117d767bbc5ce1b7.jpg",alt:""}})]),s._v(" "),n("ol",[n("li",[s._v("PLT 內每個元素都是跳轉指令，先跳去 GOT 看有沒有函數地址，沒有就跳回來再跳去 PLT 第一項去叫動態鏈接器解析地址更新，有的話直接執行就好，甭跳回來。")]),s._v(" "),n("li",[s._v("動態鏈結機制有 prelink 方法可以加速執行時間，但 prelink 跟 ASLR 的關係要再去看論文。")]),s._v(" "),n("li",[s._v("動態鏈結跟靜態鏈結各有好處跟壞處。但我認為動態鏈結更加彈性、優點更多。")])]),s._v(" "),n("h2",{attrs:{id:"六、參考連結"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、參考連結"}},[s._v("#")]),s._v(" 六、參考連結")]),s._v(" "),n("ol",[n("li",[n("p",[n("a",{attrs:{href:"https://hackmd.io/@rhythm/ry5pxN6NI",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux/ELF動態鏈接部分機制(GOT&PLT)"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.usenix.net/sites/default/files/conference/protected-files/sec15_slides_difederico.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("How the ELF ruined\nChristmas"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.cntofu.com/book/46/linked_and_loader/gothe_plt_yuan_li_jian_xi.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("GOT和PLT原理簡析"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://brandon-hy-lin.blogspot.com/2015/12/shared-library-plt-got.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Shared Library 中 PLT 和 GOT 的使用機制"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.gushiciku.cn/pl/p5nO/zh-tw",target:"_blank",rel:"noopener noreferrer"}},[s._v("動態連結的PLT與GOT"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://stackoverflow.com/questions/43048932/why-does-the-plt-exist-in-addition-to-the-got-instead-of-just-using-the-got",target:"_blank",rel:"noopener noreferrer"}},[s._v("Why does the PLT exist in addition to the GOT, instead of just using the GOT?"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://darkdust.net/files/GDB%20Cheat%20Sheet.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("gdb cheetsheet"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://github.com/kibercthulhu/gdb-peda-cheatsheet/blob/master/gdb-peda%20cheatsheet.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("gdb-peda cheetsheet"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://github.com/longld/peda",target:"_blank",rel:"noopener noreferrer"}},[s._v("gdb-peda"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://rickgray.me/2015/08/07/use-gdb-to-study-got-and-plt/",target:"_blank",rel:"noopener noreferrer"}},[s._v("通過GDB 調試理解GOT/PLT"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://luomuxiaoxiao.com/?p=343",target:"_blank",rel:"noopener noreferrer"}},[s._v("計算機原理系列之六——– 可執行文件詳解"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.technovelty.org/linux/plt-and-got-the-key-to-code-sharing-and-dynamic-libraries.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("PLT and GOT - the key to code sharing and dynamic libraries"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://reverseengineering.stackexchange.com/questions/23311/dumping-the-got-with-gdb-at-run-time",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dumping the GOT with gdb at run time"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Prelink",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prelink Wiki"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.twblogs.net/a/5c7d7b8ebd9eee114211f91d",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 Prelink 加速程序啓動"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://cosmoss-vt.github.io/pages/pubs/prelink-yoon-esa14.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dynamic-prelink: An Enhanced Prelinking Mechanism without Modifying Shared Libraries"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://csstormq.github.io/blog/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%AF%87%E4%B9%8B%E9%93%BE%E6%8E%A5%EF%BC%8814%EF%BC%89%EF%BC%9A.plt%E3%80%81.plt.got%E3%80%81.got%20%E5%92%8C%20.got.plt%20section%20%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB",target:"_blank",rel:"noopener noreferrer"}},[s._v("計算機系統篇之鍊接（14）：.plt、.plt.got、.got和.got.plt部分之間的區別"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/375510683",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux系統中編譯、鏈接的基石-ELF文件：扒開它的層層外衣，從字節碼的粒度來探索"),n("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);a.default=r.exports}}]);